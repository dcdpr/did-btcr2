<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>did:btcr2 DID Method Specification</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        <meta name="darkreader-lock"/>

        <meta name="description" content="did:btcr2 is a censorship-resistant Decentralized Identifier (DID) method using the Bitcoin blockchain as a Verifiable Data Registry to announce changes to the DID document.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="src/assets/tabs.css">
        <link rel="stylesheet" href="theme/custom.css">
        <link rel="stylesheet" href="theme/pagetoc.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "coal";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">did:btcr2 DID Method Specification</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/dcdpr/did-btcr2" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="didbtcr2-did-method"><a class="header" href="#didbtcr2-did-method"><code>did:btcr2</code> DID Method</a></h1>
<p>WARNING This specification is still under active development and may be subject to breaking changes.</p>
<h2 id="authors"><a class="header" href="#authors">Authors</a></h2>
<div class="table-wrapper"><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody>
<tr><td>Ryan Grant</td><td><a href="mailto:rgrant@contract.design">rgrant@contract.design</a></td><td><a href="https://contract.design/">Digital Contract Design</a></td></tr>
<tr><td>Will Abramson</td><td><a href="mailto:will@legreq.com">will@legreq.com</a></td><td><a href="https://legreq.com/">Legendary Requirements</a></td></tr>
<tr><td>Joe Andrieu</td><td><a href="mailto:joe@legreq.com">joe@legreq.com</a></td><td><a href="https://legreq.com/">Legendary Requirements</a></td></tr>
<tr><td>Kevin Dean</td><td><a href="mailto:kevin@legreq.com">kevin@legreq.com</a></td><td><a href="https://legreq.com/">Legendary Requirements</a></td></tr>
<tr><td>Jintek LLC</td><td><a href="mailto:info@jintek.consulting">info@jintek.consulting</a></td><td><a href="https://jintek.consulting/">Jintek LLC</a></td></tr>
<tr><td>Jennie Meier</td><td><a href="mailto:jennie@contract.design">jennie@contract.design</a></td><td><a href="https://contract.design/">Digital Contract Design</a></td></tr>
<tr><td>Jay Oster</td><td><a href="mailto:jay@blipjoy.com">jay@blipjoy.com</a></td><td><a href="https://blipjoy.com/">BlipJoy, LLC</a></td></tr>
<tr><td>Dan Pape</td><td><a href="mailto:dpape@contract.design">dpape@contract.design</a></td><td><a href="https://contract.design/">Digital Contract Design</a></td></tr>
</tbody></table>
</div>
<h2 id="contributors"><a class="header" href="#contributors">Contributors</a></h2>
<div class="table-wrapper"><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody>
<tr><td>Kate Sills</td><td><a href="mailto:katelynsills@gmail.com">katelynsills@gmail.com</a></td><td></td></tr>
<tr><td>Markus Sabadello</td><td><a href="mailto:markus@danubetech.com">markus@danubetech.com</a></td><td><a href="https://danubetech.com/">Danube Tech</a></td></tr>
</tbody></table>
</div>
<h2 id="publication-date"><a class="header" href="#publication-date">Publication Date</a></h2>
<p>… 2025</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p><a href="https://github.com/dcdpr/did-btcr2/blob/main/LICENSE">Mozilla Public License Version 2.0</a></p>
<h2 id="copyright"><a class="header" href="#copyright">Copyright</a></h2>
<p>© 2024-2025 Digital Contract Design</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="abstract"><a class="header" href="#abstract">Abstract</a></h1>
<p>did:btcr2 is a censorship-resistant Decentralized Identifier (DID) method using the Bitcoin
blockchain as a Verifiable Data Registry to announce changes to the DID document. It supports
zero-cost off-chain DID creation; aggregated updates for scalable on-chain update costs; long-term
identifiers that can support frequent updates; private communication of the DID document; private
DID resolution; and non-repudiation.</p>
<hr>
<h1 id="introduction-and-motivation"><a class="header" href="#introduction-and-motivation">Introduction and Motivation</a></h1>
<p>Public digital identity was introduced to the Internet through Pretty
Good Privacy’s (PGP) foundational legal work in the 1990s. With
Decentralized Identifiers (DIDs), digital identity can be preserved
through a rotation of key material, without relying on a centralized
party. This specification defines did:btcr2, a DID method designed and
motivated by the following considerations:</p>
<h2 id="anti-censorship"><a class="header" href="#anti-censorship">Anti-censorship</a></h2>
<p>Our primary motivation is to leverage the anti-censorship capability
of Bitcoin to enable individuals to control decentralized identifiers
without interference by centralized players. That means creating a W3C
conformant DID method capable of creating identifiers usable for a
range of verifiable interactions, including issuing Verifiable
Credentials and proving that the current presenter is the subject of a
Verifiable Credential. This DID method gives organizations and states
the ability to anchor private attestations to identifiers under
individuals’ direct control, giving humans an unprecedented ability to
participate in digital interactions on their own terms, using the
identifiers they choose, when they choose.</p>
<h2 id="privacy"><a class="header" href="#privacy">Privacy</a></h2>
<p>The first DID method anchoring on the Bitcoin blockchain, did:btcr,
focused on censorship resistance. However, self-sovereign identity is
not complete without options for privacy as well, and the initial
promise of privacy in the DID ecosystem was dubious, with heavy reliance
on public DID documents. There has been a presumption that anyone who
has the DID itself should be able to resolve it to get the current DID
document. This presumption places more information in the public eye
than is strictly necessary for securing interactions related to the DID.</p>
<p>To tackle reliance on public DID documents head-on, this DID method
introduces private DID documents, in which resolving the DID requires
additional information delivered either alongside or in a separate
communication from the DID controller. We call this transfer Sidecar
delivery. Our approach ensures that successful resolution ALWAYS results
in the same DID document for all parties, so that every party in the
ecosystem sees the same cryptographically anchored result.</p>
<h2 id="late-publishing"><a class="header" href="#late-publishing">Late Publishing</a></h2>
<p>Many DID methods lack verifiable provenance: it is simply impossible to
reconstruct a cryptographically verifiable history of updates. Instead,
they use a Verifiable Data Registry that can rewrite history. Bitcoin’s
blockchain is the premiere global network for immutably anchoring
information to a specific time. This DID method ensures that every BTCR2
DID is anchored on a single, canonical, immutable history for the
lifetime of the DID. It is simply not possible for anyone to modify the
history of the DID. We call this feature Non-Repudiation.</p>
<h2 id="offline-creation"><a class="header" href="#offline-creation">Offline Creation</a></h2>
<p>Finally, we wanted to support the creation of DIDs without requiring
on-chain interactions. BTCR creation depended on getting a transaction
on-chain. BTCR2 supports creating DIDs with sophisticated DID documents
without registering them on-chain. In fact, all BTCR2 DIDs start with
offline creation. Only updates to the DID document require on-chain
interactions. Our approach supports both key-based deterministic DIDs
and document-based deterministic DIDs. In key-based DIDs, the DID itself
contains everything you need to bootstrap an initial DID Document with
usable verification methods suitable for authentication, attestation,
and capability invocation and delegation. For document-based DIDs,
additional Sidecar Data - a Genesis Document - must be used to create
the Initial DID document. Offline creation allows unlimited DID creation
and use without requiring any on-chain or online interactions, making it
suitable for a wide range of high-volume, low cost use cases.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="conformance"><a class="header" href="#conformance">Conformance</a></h1>
<p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p>
<p>The key words MAY, MUST, MUST NOT, RECOMMENDED, SHOULD, and SHOULD NOT in this document are to be interpreted as described in [<a href="bibliography.html#BCP14">BCP14</a>] when, and only when, they appear in all capitals, as shown here.</p>
<p>Interoperability of implementations of the <strong>did:btcr2</strong> DID method is tested by evaluating an implementation’s ability to create, update, deactivate, and resolve <strong>did:btcr2</strong> identifiers and DID Documents that conform to this specification. Interoperability for producers and consumers of <strong>did:btcr2</strong> identifier and DID Documents is provided by ensuring the DIDs and DID Documents conform.</p>
<p>Implementations MUST be conformant to all normative statements in Decentralized Identifiers v1.1 [<a href="bibliography.html#DID-CORE">DID-CORE</a>] and DID Resolution v0.3 [<a href="bibliography.html#DID-RESOLUTION">DID-RESOLUTION</a>].</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="terminology"><a class="header" href="#terminology">Terminology</a></h1>
<h2 id="aggregate-beacon"><a class="header" href="#aggregate-beacon">Aggregate Beacon</a></h2>
<p>A collection of <a href="./terminology.html#btcr2-update">BTCR2 Updates</a> can optionally be aggregated into a single
<a href="./terminology.html#beacon-signal">Beacon Signal</a> by an <a href="./terminology.html#aggregation-service">Aggregation Service</a> for multiple entities (possibly controlling
multiple DIDs and possibly posting multiple updates).</p>
<p>There can only ever be one <a href="./terminology.html#btcr2-update">BTCR2 Update</a> per <strong>did:btcr2</strong> DID in a <a href="./terminology.html#beacon-signal">Beacon Signal</a> from an
Aggregate Beacon.</p>
<h2 id="aggregation-cohort"><a class="header" href="#aggregation-cohort">Aggregation Cohort</a></h2>
<p>The set of <a href="./terminology.html#aggregation-participant">Aggregation Participants</a> within an <a href="./terminology.html#aggregate-beacon">Aggregate Beacon</a>.</p>
<h2 id="aggregation-participant"><a class="header" href="#aggregation-participant">Aggregation Participant</a></h2>
<p>A member of an <a href="./terminology.html#aggregation-cohort">Aggregation Cohort</a>, typically a DID controller, that controls cryptographic keys
required to partially authorize spends from a <a href="./terminology.html#beacon-address">Beacon Address</a>.</p>
<h2 id="aggregation-service"><a class="header" href="#aggregation-service">Aggregation Service</a></h2>
<p>The entity that coordinates the protocols of an <a href="./terminology.html#aggregate-beacon">Aggregate Beacon</a> in order to establish a
<a href="./terminology.html#aggregation-cohort">Aggregation Cohort</a> and aggregate <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcements</a> in a
<a href="./terminology.html#beacon-signal">Beacon Signal</a>.</p>
<h2 id="authorized-beacon=signal"><a class="header" href="#authorized-beacon=signal">Authorized Beacon Signal</a></h2>
<p>An Authorized Beacon Signal is a <a href="./terminology.html#beacon-signal">Beacon Signal</a> from a <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a> with a <a href="./terminology.html#beacon-address">Beacon Address</a>
in a then-current DID document.</p>
<h2 id="beacon-address"><a class="header" href="#beacon-address">Beacon Address</a></h2>
<p>The Bitcoin address of a <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a>. Spends of <a href="./terminology.html#utxo">UTXO</a> controlled by this address are identified
as <a href="./terminology.html#beacon-signal">Beacon Signals</a>.</p>
<h2 id="beacon-announcement-map"><a class="header" href="#beacon-announcement-map">Beacon Announcement Map</a></h2>
<p>A document that maps <strong>did:btcr2</strong> identifiers to <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcements</a>. This is used to distinguish which <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcement</a> applies to
which <strong>did:btcr2</strong> identifier.</p>
<h2 id="beacon-signal"><a class="header" href="#beacon-signal">Beacon Signal</a></h2>
<p>Beacon Signals are Bitcoin transactions that spend from a <a href="./terminology.html#beacon-address">Beacon Address</a> and include a
transaction output of the format defined in <a href="./terminology.html#signal-bytes">Signal Bytes</a>. Beacon Signals announce one or more
<a href="./terminology.html#btcr2-update">BTCR2 Updates</a> and provide a means for these updates to be validated against the
Beacon Signal.</p>
<p>The type of the <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a> determines how these Beacon Signals are constructed and processed to
validate a set of <a href="./terminology.html#btcr2-update">BTCR2 Updates</a> against the <a href="./terminology.html#signal-bytes">Signal Bytes</a> contained within the
Beacon Signal.</p>
<h2 id="beacon-type"><a class="header" href="#beacon-type">Beacon Type</a></h2>
<p>The type of a <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a>. The Beacon Type defines how <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcements</a> are included within a <a href="./terminology.html#beacon-signal">Beacon Signal</a> broadcast on the Bitcoin network. It also
defines how the content committed within <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcements</a>
can be validated against the <a href="./terminology.html#beacon-signal">Beacon Signal</a>.</p>
<h2 id="btcr2-beacon"><a class="header" href="#btcr2-beacon">BTCR2 Beacon</a></h2>
<p>A service listed in a BTCR2 DID document that informs resolvers how to find authentic updates to the
DID. It MUST be either a <a href="./terminology.html#singleton-beacon">Singleton Beacon</a>, <a href="./terminology.html#smt-beacon">SMT Beacon</a>, or a <a href="./terminology.html#cas-beacon">CAS Beacon</a>.</p>
<h2 id="btcr2-update"><a class="header" href="#btcr2-update">BTCR2 Update</a></h2>
<p>A data structure used for transforming a source DID document into a target DID document. It contains
a JSON Patch [<a href="bibliography.html#RFC6902">RFC6902</a>] object, a version number for the target DID document, and SHA-256
hashes for the source and target DID documents.</p>
<h2 id="btcr2-unsigned-update"><a class="header" href="#btcr2-unsigned-update">BTCR2 Unsigned Update</a></h2>
<p>A <a href="./terminology.html#btcr2-update">BTCR2 Update</a> without a proof attached to it.</p>
<p>Example: <a href="./data-structures.html#btcr2-unsigned-update">BTCR2 Unsigned Update (data structure)</a>.</p>
<h2 id="btcr2-update-announcement"><a class="header" href="#btcr2-update-announcement">BTCR2 Update Announcement</a></h2>
<p>A 32-byte SHA-256 hash committing to a <a href="./terminology.html#btcr2-update">BTCR2 Update</a> that has been broadcast by a <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a> in
a DID’s then-<a href="./terminology.html#authorized-beacon-signal">Authorized Beacon Signal</a>. <a href="./terminology.html#beacon-signal">Beacon Signals</a> can optionally aggregate
one or more BTCR2 Update Announcements. How <a href="./terminology.html#beacon-signal">Beacon Signals</a> aggregate announcements
is defined by the <a href="./terminology.html#beacon-type">Beacon Type</a>.</p>
<h2 id="btcr2-signed-update"><a class="header" href="#btcr2-signed-update">BTCR2 Signed Update</a></h2>
<p>A <a href="./terminology.html#btcr2-update">BTCR2 Update</a> with a proof attached to it.</p>
<p>A capability invocation secured using Data Integrity [<a href="bibliography.html#VC-DATA-INTEGRITY">VC-DATA-INTEGRITY</a>] that invokes an authorization capability to
update a specific <strong>did:btcr2</strong> DID document. This capability invocation Data Integrity proof
secures the <a href="./terminology.html#btcr2-unsigned-update">BTCR2 Unsigned Update</a> document.</p>
<p>Example: <a href="./data-structures.html#btcr2-signed-update">BTCR2 Signed Update (data structure)</a>.</p>
<h2 id="cas"><a class="header" href="#cas">CAS</a></h2>
<p><a href="./terminology.html#content-addressable-storage">Content Addressable Storage</a></p>
<h2 id="cas-beacon"><a class="header" href="#cas-beacon">CAS Beacon</a></h2>
<p>A type of <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a> which aggregates multiple
<a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcements</a>. A <a href="./terminology.html#beacon-signal">Beacon Signal</a> from a CAS Beacon commits
to a <a href="./terminology.html#beacon-announcement-map">Beacon Announcement Map</a>.</p>
<h2 id="cid"><a class="header" href="#cid">CID</a></h2>
<p><a href="./terminology.html#content-identifier">Content Identifier</a></p>
<h2 id="content-addressable-storage"><a class="header" href="#content-addressable-storage">Content Addressable Storage</a></h2>
<p>Content Addressable Storage (CAS) is a data storage system where content is addressable using
<a href="./terminology.html#content-identifier">Content Identifiers</a> (CIDs). The InterPlanetary File System (IPFS) is an
example of CAS.</p>
<h2 id="content-identifier"><a class="header" href="#content-identifier">Content Identifier (CID)</a></h2>
<p>An identifier for some digital content (e.g., a file) generated from the content itself such that
for any given content and CID generation algorithm there is a single, unique, collision-resistant
identifier. This is typically done through some hashing function.</p>
<h2 id="current-did-document"><a class="header" href="#current-did-document">Current DID Document</a></h2>
<p>The transient state of the DID document during DID resolution. The
Current DID Document is iteratively updated as a resolver traverses the blockchain and applies the relevant
<a href="./terminology.html#btcr2-update">BTCR2 Updates</a> announced by <a href="./terminology.html#authorized-beacon-signal">Authorized Beacon Signals</a> it
identifies in specific Bitcoin blocks.</p>
<h2 id="data-integrity-proof"><a class="header" href="#data-integrity-proof">Data Integrity Proof</a></h2>
<p>A digital signature added to a <a href="./terminology.html#btcr2-unsigned-update">BTCR2 Unsigned Update</a> in order to convert
to a <a href="./terminology.html#btcr2-signed-update">BTCR2 Signed Update</a>.</p>
<p>The algorithm is specified in BIP340 Cryptosuites v0.1 [<a href="bibliography.html#BIP340-Cryptosuite">BIP340-Cryptosuite</a>] and Verifiable Credential Data Integrity 1.0 [<a href="bibliography.html#VC-DATA-INTEGRITY">VC-DATA-INTEGRITY</a>].</p>
<h2 id="genesis-bytes"><a class="header" href="#genesis-bytes">Genesis Bytes</a></h2>
<p>The bytes used to generate a <strong>did:btcr2</strong> identifier. These bytes are either a 33-byte compressed
Standards for Efficient Cryptography ([<a href="bibliography.html#SEC">SEC</a>]) encoded secp256k1 public key or a 32-byte SHA-256 hash
of a <a href="./terminology.html#genesis-document">Genesis Document</a>.</p>
<h2 id="genesis-document"><a class="header" href="#genesis-document">Genesis Document</a></h2>
<p>An intermediate representation of an <a href="./terminology.html#initial-did-document">Initial DID Document</a> with the identifier set to the
placeholder value.</p>
<p>Example: <a href="./data-structures.html#genesis-document">Genesis Document (data structure)</a>.</p>
<h2 id="initial-did-document"><a class="header" href="#initial-did-document">Initial DID Document</a></h2>
<p>The canonical, conformant version 1 of a DID document for a specific <strong>did:btcr2</strong> identifier.</p>
<p>Example: <a href="./data-structures.html#initial-document">Initial document (data structure)</a>.</p>
<h2 id="late-publishing"><a class="header" href="#late-publishing">Late Publishing</a></h2>
<p>Late Publishing is the ability for DID updates to be revealed at a later point in time, which alters
the history of a DID document such that a state, that appeared valid before the reveal, appears
after Late Publishing to never have been valid. Late Publishing breaks <a href="./terminology.html#non-repudiation">Non-Repudiation</a>.</p>
<h2 id="merkle-tree"><a class="header" href="#merkle-tree">Merkle Tree</a></h2>
<p>A tree data structure in which the leaves are a hash of a data block and every node that is not a
leaf is a hash of its child node values.</p>
<p>The root of a Merkle Tree is a single hash that is produced by recursively hashing the child nodes
down to the leaves of the tree. Given the root of a Merkle Tree it is possible to provide a Merkle
path that proves the inclusion of some data in the tree.</p>
<h2 id="non-repudiation"><a class="header" href="#non-repudiation">Non-Repudiation</a></h2>
<p>Non-Repudiation is a feature of DID methods that can clearly state that all data is available to
present one canonical history for a DID.</p>
<p>If some data is needed but not available, the DID method MUST NOT allow DID resolution to complete.
Any changes to the history, such as may occur if a website edits a file, MUST be detected and
disallowed. The <a href="./terminology.html#late-publishing">Late Publishing</a> problem breaks Non-Repudiation.</p>
<h2 id="offline-creation"><a class="header" href="#offline-creation">Offline Creation</a></h2>
<p>Offline Creation refers to when a <strong>did:btcr2</strong> identifier and corresponding <a href="./terminology.html#initial-did-document">Initial DID Document</a>
are created without requiring network interactions.</p>
<p><strong>did:btcr2</strong> supports Offline Creation in two modes:</p>
<ul>
<li>Key Pair Deterministic Creation; and</li>
<li>DID Document Initiated Creation.</li>
</ul>
<h2 id="resolution-time"><a class="header" href="#resolution-time">Resolution Time</a></h2>
<p>A Coordinated Universal Time (UTC) timestamp set when the resolver receives a resolution request.</p>
<h2 id="schnorr-signature"><a class="header" href="#schnorr-signature">Schnorr Signature</a></h2>
<p>An alternative to Elliptic Curve Digital Signature Algorithm (ECDSA) signatures with some major
advantages, such as being able to combine digital signatures from multiple parties to form a single
digital signature for the composite public key.</p>
<p>Bitcoin <a href="./terminology.html#schnorr-signature">Schnorr Signatures</a> are still over the secp256k1 curve, so the same keypairs can be used to produce both <a href="./terminology.html#schnorr-signature">Schnorr Signatures</a> and ECDSA signatures.</p>
<h2 id="sidecar"><a class="header" href="#sidecar">Sidecar</a></h2>
<p>A mechanism by which data necessary for resolving a DID is provided alongside the <strong>did:btcr2</strong>
identifier being resolved, rather than being retrieved through open and standardized means (e.g., by
retrieving from IPFS).</p>
<p>To explain the metaphor, a sidecar on a motorcycle brings along a second passenger in a transformed
vehicle, the same way the DID controller MUST bring along the DID document history to transform the
situation into one that is verifiable.</p>
<h2 id="sidecar-data"><a class="header" href="#sidecar-data">Sidecar Data</a></h2>
<p>Data transmitted via <a href="./terminology.html#sidecar">Sidecar</a>.</p>
<h2 id="signal-bytes"><a class="header" href="#signal-bytes">Signal Bytes</a></h2>
<p>The 32 bytes of information that are included within the last transaction output of a
<a href="./terminology.html#beacon-signal">Beacon Signal</a>. The script of this transaction output has the following form:</p>
<p><code>[OP_RETURN, OP_PUSH_BYTES, &lt;signal_bytes&gt;]</code></p>
<h2 id="singleton-beacon"><a class="header" href="#singleton-beacon">Singleton Beacon</a></h2>
<p>A type of <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a> whose <a href="./terminology.html#beacon-signal">Beacon Signals</a> each contain a single <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update
Announcement</a>.</p>
<h2 id="smt"><a class="header" href="#smt">SMT</a></h2>
<p><a href="./terminology.html#sparse-merkle-tree">Sparse Merkle Tree</a></p>
<h2 id="smt-beacon"><a class="header" href="#smt-beacon">SMT Beacon</a></h2>
<p>A type of <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a> which aggregates multiple <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcements</a> using an optimized <a href="./terminology.html#sparse-merkle-tree">Sparse Merkle Tree</a>.</p>
<p>A <a href="./terminology.html#beacon-signal">Beacon Signal</a> from an SMT Beacon contains the root of an optimized <a href="./terminology.html#sparse-merkle-tree">Sparse Merkle Tree</a>.</p>
<h2 id="smt-proof"><a class="header" href="#smt-proof">SMT Proof</a></h2>
<p>A set of SHA-256 hashes for nodes in a <a href="./terminology.html#sparse-merkle-tree">Sparse Merkle Tree</a> that together form a path from a leaf in
the tree to the Merkle root, proving that the leaf is in the tree.</p>
<h2 id="sparse-merkle-tree"><a class="header" href="#sparse-merkle-tree">Sparse Merkle Tree</a></h2>
<p>A <a href="./terminology.html#merkle-tree">Merkle Tree</a> data structure where each data point included at the leaf of the tree is indexed.</p>
<p>This data structure enables proofs of both inclusion and non-inclusion of data at a given index. The
instantiation in this specification has 2^256 leaves that are indexed by the SHA-256 hash of
a <strong>did:btcr2</strong> identifier.</p>
<h2 id="unsigned-beacon-signal"><a class="header" href="#unsigned-beacon-signal">Unsigned Beacon Signal</a></h2>
<p>The Bitcoin transaction of the <a href="./terminology.html#beacon-signal">Beacon Signal</a> before its transaction inputs have been signed,
effectively spending these inputs.</p>
<h2 id="unspent-transaction-output"><a class="header" href="#unspent-transaction-output">Unspent Transaction Output (UTXO)</a></h2>
<p>A Bitcoin transaction takes in transaction outputs as inputs and creates new transaction outputs
potentially controlled by different addresses. An Unspent Transaction Output (UTXO) is a
transaction output from a Bitcoin transaction that has not yet been included as an input, and hence
spent, within another Bitcoin transaction.</p>
<h2 id="utxo"><a class="header" href="#utxo">UTXO</a></h2>
<p><a href="./terminology.html#unspent-transaction-output">Unspent Transaction Output</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="btcr2-update-data-distribution"><a class="header" href="#btcr2-update-data-distribution">BTCR2 Update Data Distribution</a></h1>
<p>In many cases, additional data is required for resolution. In those cases, the resolver can receive data via two primary means from a DID controller, both secured by cryptographic hash:</p>
<ol>
<li><a href="./terminology.html#sidecar">Sidecar</a></li>
<li><a href="./terminology.html#content-addressable-storage">Content Addressable Storage</a> (<a href="./terminology.html#cas">CAS</a>)</li>
</ol>
<p>All <a href="./terminology.html#btcr2-update">BTCR2 Update</a> data must be made available to the resolver to enable full resolution of the DID document. Cryptographic hashes and signatures ensure the integrity and authenticity of data shared from controller to resolver.</p>
<p>All documents used for resolution are JSON documents, identified by their SHA-256 cryptographic hash calculated after first canonicalizing the document according to the <a href="./algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm.</p>
<p>As a resolver goes through the resolution process, it encounters one or more document hashes, which it uses to identify the files of interest. See <a href="./operations/resolve.html#process-sidecar-data">Process Sidecar Data</a>.</p>
<p>While it’s possible for a single <strong>did:btcr2</strong> identifier to mix the two distribution mechanisms, it is NOT RECOMMENDED. Instead, it is RECOMMENDED that controllers pick a distribution mechanism and use it throughout the lifetime of a given DID.</p>
<h2 id="sidecar"><a class="header" href="#sidecar">Sidecar</a></h2>
<p><a href="./terminology.html#sidecar">Sidecar</a> provides additional update data alongside the <strong>did:btcr2</strong> identifier being resolved. This is analogous to a sidecar on a motorcycle bringing along a second passenger: the DID controller provides the DID document history (in the form of <a href="./terminology.html#btcr2-update">BTCR2 Updates</a> and any additional proofs) along with DID to the relying party so that the resolver can construct the DID document.</p>
<p>When a resolver is presented with a <strong>did:btcr2</strong> identifier, it is also presented with documents matching the SHA-256 hashes it encounters during the resolution process. If any SHA-256 hash doesn’t have a corresponding file, the resolution fails.</p>
<h2 id="content-addressable-storage-cas"><a class="header" href="#content-addressable-storage-cas">Content Addressable Storage (CAS)</a></h2>
<p><a href="./terminology.html#content-addressable-storage">Content Addressable Storage</a> (CAS) is a mechanism by which a digital file is stored on a network for retrieval based on its content, not its name or location. The content address is determined by a cryptographic hash of the file. The hash is then passed into a retrieval function specific to the type of CAS to retrieve the file.</p>
<p>Any CAS that provides a deterministic mapping from a SHA-256 hash of a file may be used, and a resolver SHOULD be informed of the specific CAS mechanism so that it can retrieve documents associated with a <strong>did:btcr2</strong> identifier efficiently. If the CAS mechanism is not provided, the resolver MAY iterate through all supported CAS mechanisms to find the files or it MAY return with an error indicating that the CAS mechanism is required.</p>
<p>At this time, IPFS is the only known CAS to provide a deterministic mapping from a SHA-256 hash.</p>
<h3 id="interplanetary-file-system-ipfs"><a class="header" href="#interplanetary-file-system-ipfs">Interplanetary File System (IPFS)</a></h3>
<p>The Interplanetary File System (IPFS) “is a set of open protocols for addressing, routing, and transferring data on the web, built on the ideas of content addressing and peer-to-peer networking.”</p>
<p>A detailed description is available at the <a href="https://docs.ipfs.tech/">IPFS documentation site</a>, but for the purposes of <strong>did:btcr2</strong>, it is a distributed file system where the files are identified using a unique <a href="./terminology.html#content-identifier">Content Identifier</a> (<a href="./terminology.html#cid">CID</a>) based on the content of the file. The content of the file determines the CID, and the CID may be used by anyone, anywhere, to retrieve the file.</p>
<p>For <strong>did:btcr2</strong> identifiers, files stored in IPFS MUST override the default chunking behaviour by storing the file as a raw binary using the <a href="https://richardschneider.github.io/net-ipfs-engine/articles/fs/raw.html">Raw Leaves option</a>. This limits the file size to the block size (default 256 kB, maximum 1 MB), but that should be sufficient for most applications, ensuring that the entire file is included when calculating the CID.</p>
<p>The IPFS CIDv1 is a binary identifier constructed from the file hash as:</p>
<ul>
<li><code>0x01</code>, the code for CIDv1;</li>
<li><code>0x00</code>, the <a href="https://github.com/multiformats/multicodec">multicodec</a> code for raw binary;</li>
<li><code>0x12</code>, the <a href="https://github.com/multiformats/multihash">multihash</a> code for SHA-256; and</li>
<li>the SHA-256 of the file.</li>
</ul>
<p>The stringified version of the CIDv1 is accomplished using <a href="https://github.com/multiformats/multibase">multibase</a> encoding. The final URL is <code>"ipfs://&lt;stringified CIDv1&gt;"</code>.</p>
<p>A resolver retrieves a file associated with a SHA-256 hash by constructing the IPFS CIDv1 and requesting the file from an IPFS node.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="beacons"><a class="header" href="#beacons">Beacons</a></h1>
<p>A <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a> is a service listed in a BTCR2 DID document that informs resolvers how to find authentic updates to the DID. The service properties define a Bitcoin address to watch for <a href="./terminology.html#beacon-signal">Beacon Signals</a>.</p>
<p>All Beacon Signals broadcast from a <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a> in the <a href="./terminology.html#current-did-document">Current DID Document</a> MUST be processed as part of DID document resolution. The <a href="./terminology.html#beacon-type">Beacon Type</a> in the service defines how <a href="./terminology.html#beacon-signal">Beacon Signals</a> MUST be processed.</p>
<p>Any on-chain <a href="./terminology.html#beacon-signal">Beacon Signal</a> that cannot be processed renders the related DID invalid. For this reason, all DID controllers SHOULD ensure the <a href="./terminology.html#beacon-address">Beacon Addresses</a> they include in their DID document require appropriate approval to spend <a href="./terminology.html#utxo">UTXOs</a> controlled by the address, so that only approved <a href="./terminology.html#beacon-signal">Beacon Signals</a> can be posted to Bitcoin. For resilience, BTCR2 DIDs can specify any number of <a href="./terminology.html#btcr2-beacon">Beacons</a> and SHOULD include at least one <a href="./terminology.html#singleton-beacon">Singleton Beacon</a> as a fallback in case all <a href="./terminology.html#aggregate-beacon">Aggregate Beacons</a> fail.</p>
<p>A <a href="./terminology.html#beacon-signal">Beacon Signal</a> commits to, and anchors in a Bitcoin block, 32 bytes of information. These <a href="./terminology.html#signal-bytes">Signal Bytes</a> represent one of the following:</p>
<ul>
<li>A <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcement</a>;</li>
<li>The hash of a <a href="./terminology.html#beacon-announcement-map">Beacon Announcement Map</a>; or</li>
<li>The 32 bytes of an optimized <a href="./terminology.html#sparse-merkle-tree">Sparse Merkle Tree</a> root, where each leaf node is deterministically selected by a <strong>did:btcr2</strong> identifier and contains a hash associated with the <strong>did:btcr2</strong> identifier.</li>
</ul>
<p><strong>did:btcr2</strong> supports different <a href="./terminology.html#beacon-type">Beacon Types</a>, with each type defining a set of algorithms for:</p>
<ul>
<li>How a <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a> can be established and added as a service to a DID document.</li>
<li>How <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcements</a> are broadcast within <a href="./terminology.html#beacon-signal">Beacon Signals</a>.</li>
<li>How a resolver processes <a href="./terminology.html#beacon-signal">Beacon Signals</a>, identifying, verifying, and applying the authorized mutations to a DID document for a specific DID.</li>
</ul>
<p>The current, active, <a href="./terminology.html#btcr2-beacon">BTCR2 Beacons</a> of a DID document are specified in the document’s <code>service</code> property. By updating the DID document, a DID controller can change the set of <a href="./terminology.html#btcr2-beacon">BTCR2 Beacons</a> they use to broadcast updates to their DID document over time. Resolution of a DID MUST process signals from all <a href="./terminology.html#btcr2-beacon">BTCR2 Beacons</a> identified in the <a href="./terminology.html#current-did-document">Current DID Document</a> and apply them in the order determined by the <code>targetVersionId</code> declared in the <a href="./data-structures.html#btcr2-signed-update">BTCR2 Signed Update (data structure)</a>.</p>
<p>All <strong>did:btcr2</strong> DID resolvers MUST support the <a href="./terminology.html#beacon-type">Beacon Types</a> defined in this specification.</p>
<h2 id="beacon-types"><a class="header" href="#beacon-types">Table 1: Beacon Types</a></h2>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Service <code>type</code></th><th style="text-align: left">Beacon Type</th></tr></thead><tbody>
<tr><td style="text-align: left"><code>"SingletonBeacon"</code></td><td style="text-align: left"><a href="./terminology.html#singleton-beacon">Singleton Beacon</a></td></tr>
<tr><td style="text-align: left"><code>"CASBeacon"</code></td><td style="text-align: left"><a href="./terminology.html#cas-beacon">CAS Beacon</a></td></tr>
<tr><td style="text-align: left"><code>"SMTBeacon"</code></td><td style="text-align: left"><a href="./terminology.html#smt-beacon">SMT Beacon</a></td></tr>
</tbody></table>
</div>
<h2 id="singleton-beacon"><a class="header" href="#singleton-beacon">Singleton Beacon</a></h2>
<p>A <a href="./terminology.html#singleton-beacon">Singleton Beacon</a> is a <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a> that can be used to announce commitments to a single <a href="./terminology.html#btcr2-update">BTCR2 Update</a> targeting a single DID document. It creates a <a href="./terminology.html#beacon-signal">Beacon Signal</a> that commits to a single <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcement</a>. This is typically done directly by the DID controller, as there is no <a href="./terminology.html#aggregation-cohort">Aggregation Cohort</a>.</p>
<p>If the <a href="./terminology.html#btcr2-update">BTCR2 Update</a> committed to by the <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcement</a> is not publicly discoverable (i.e., is not published to a CAS under its hash), the only parties that are aware of it are the DID controller and any parties provided it by the DID controller.</p>
<p>The <code>type</code> of a <code>service</code> defining a <a href="./terminology.html#singleton-beacon">Singleton Beacon</a> in a DID document is <code>"SingletonBeacon"</code>.</p>
<h2 id="cas-beacon"><a class="header" href="#cas-beacon">CAS Beacon</a></h2>
<p>A <a href="./terminology.html#cas-beacon">CAS Beacon</a> creates a <a href="./terminology.html#beacon-signal">Beacon Signal</a> that commits to multiple <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcements</a> through a <a href="./terminology.html#beacon-announcement-map">Beacon Announcement Map</a>. To do so, it constructs a Map where the key is the <strong>did:btcr2</strong> identifier and the value is the hash of the corresponding <a href="./terminology.html#btcr2-update">BTCR2 Update</a>. The <a href="./terminology.html#beacon-signal">Beacon Signal</a> contains a SHA-256 hash of the Map.</p>
<p>If a <a href="./terminology.html#btcr2-update">BTCR2 Update</a> is not publicly discoverable (i.e., is not published to a CAS under its hash), the only parties with access to the update are the DID controller and any parties they gave it to (etc.).</p>
<p>For a <a href="./terminology.html#cas-beacon">CAS Beacon</a>, proof of non-inclusion of a <strong>did:btcr2</strong> identifier is simply its absence from the Map.</p>
<p>The <code>type</code> of a <code>service</code> defining a <a href="./terminology.html#cas-beacon">CAS Beacon</a> in a DID document is <code>"CASBeacon"</code>.</p>
<h2 id="smt-beacon"><a class="header" href="#smt-beacon">SMT Beacon</a></h2>
<p>An <a href="./terminology.html#smt-beacon">SMT Beacon</a> creates a <a href="./terminology.html#beacon-signal">Beacon Signal</a> that commits to multiple <a href="./terminology.html#btcr2-update-announcement">BTCR2 Update Announcements</a>, each identified by a <strong>did:btcr2</strong> identifier. To do so, it constructs an optimized <a href="./terminology.html#sparse-merkle-tree">Sparse Merkle Tree</a> as defined in <a href="./appendix.html#smt-implementation">Appendix: Optimized Sparse Merkle Tree Implementation</a> and publishes the Merkle root.</p>
<p>An <a href="./terminology.html#smt-beacon">SMT Beacon</a> provides maximum privacy for the DID controller, as the DID controller never has to reveal their DIDs or <a href="./terminology.html#btcr2-update">BTCR2 Updates</a> to the aggregator.</p>
<p>The <code>type</code> of a <code>service</code> defining an <a href="./terminology.html#smt-beacon">SMT Beacon</a> in a DID document is <code>"SMTBeacon"</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="aggregate-beacons"><a class="header" href="#aggregate-beacons">Aggregate Beacons</a></h1>
<p>DID controllers can use a <a href="beacons/../terminology.html#cas-beacon">CAS Beacon</a>, an <a href="beacons/../terminology.html#smt-beacon">SMT Beacon</a>, or both to participate in BTCR2 Update Aggregation. In contrast to a <a href="beacons/../terminology.html#singleton-beacon">Singleton Beacon</a>, which only allows for one <a href="beacons/../terminology.html#btcr2-update">BTCR2 Update</a> per Bitcoin transaction, <a href="beacons/../terminology.html#aggregate-beacon">Aggregate Beacons</a> combine multiple <a href="beacons/../terminology.html#btcr2-update">BTCR2 Updates</a> into one Bitcoin transaction for any number of DID controllers. In this context, DID BTCR2 controllers are called <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a>.</p>
<h2 id="btcr2-update-aggregation"><a class="header" href="#btcr2-update-aggregation">BTCR2 Update Aggregation</a></h2>
<p>BTCR2 Update Aggregation is the coordination protocol used by an <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> and <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> to perform aggregation. A full protocol definition is out of scope for this specification, but a RECOMMENDED example is provided for illustration.</p>
<h2 id="example-using-musig2-secp256k1-and-schnorr-signatures"><a class="header" href="#example-using-musig2-secp256k1-and-schnorr-signatures">Example Using Musig2, secp256k1, and Schnorr Signatures</a></h2>
<p>One implementation, centered on Schnorr signatures, allows all <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> to veto any <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a> for which their own proof data does not match the proposed <code>OP_RETURN</code> data. DID controllers that wish to join an <a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohort</a> and become an <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a> would need to provide the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> with a Schnorr public key.</p>
<p>The <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> coordinates the construction of an <code>n-of-n</code> Pay-to-Taproot address as the <a href="beacons/../terminology.html#beacon-address">Beacon Address</a>, where each <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant’s</a> public key is one of the <code>n</code> keys. This ensures that all on-chain <a href="beacons/../terminology.html#beacon-signal">Beacon Signals</a> are cryptographically signed by every <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a>, while the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> remains minimally trusted.</p>
<p>An <a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohort</a> may fail if <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> stop participating or the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> is compromised. If that happens, the <a href="beacons/../terminology.html#aggregate-beacon">Aggregate Beacon</a> simply fails to broadcast <a href="beacons/../terminology.html#beacon-signal">Beacon Signals</a> that announce <a href="beacons/../terminology.html#btcr2-update">BTCR2 Updates</a>.</p>
<p>The <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> decides when to finalize the membership of the <a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohort</a>. After it does, it computes an <code>n-of-n</code> Pay-to-Taproot address from the public keys the <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> provided. This <a href="beacons/../terminology.html#beacon-address">Beacon Address</a> must be sent to all <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> with the set of keys used to construct it. Each <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a> should verify the address and confirm that their key is included.</p>
<p>Once the <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> have verified the newly formed <a href="beacons/../terminology.html#beacon-address">Beacon Address</a>, they can construct the <code>service</code> object that can be included within their DID document’s service array.</p>
<p>This RECOMMENDED setup ensures that neither the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> nor other <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> can compromise or invalidate a <strong>did:btcr2</strong> identifier of another <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a> in the cohort.</p>
<p>The actors involved in aggregation are as follows.</p>
<ul>
<li>DID controller - A party that controls one or more <strong>did:btcr2</strong> identifiers.</li>
<li><a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a> - A DID controller in the BTCR2 Update Aggregation context after joining an <a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohort</a>.</li>
<li><a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohort</a> - A set of <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> who have submitted cryptographic material to an <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a>.</li>
<li><a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> - A single entity who coordinates the protocols and is ultimately responsible for broadcasting the <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a> formed as a result of BTCR2 Update Aggregation.</li>
<li>Verifier - A party verifying a <strong>did:btcr2</strong> identifier presentation.</li>
</ul>
<h3 id="step-1-create-aggregation-cohort"><a class="header" href="#step-1-create-aggregation-cohort">Step 1: Create Aggregation Cohort</a></h3>
<p>Creating an <a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohort</a> requires that the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> define the conditions for it, advertise the new cohort to prospective <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a>, and accept enrollment.</p>
<p>When defining an <a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohort</a>, the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> can define conditions such as:</p>
<ul>
<li>Beacon type (CAS or SMT).</li>
<li>Minimum and/or maximum number of <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a>.</li>
<li>Minimum and/or maximum number of DIDs per <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a>.</li>
<li>Cost of enrollment.</li>
<li>Cost per announcement per DID or <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a>.</li>
<li>Minimum and/or maximum time between announcements.</li>
<li>Number of pending updates that trigger an announcement.</li>
</ul>
<p>Advertising <a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohorts</a> to participants can be done with nostr or DIDComm.</p>
<p>Enrolling in an <a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohort</a> requires exchanging DIDs or indexes (hashes of DIDs) and the public keys used to create the <code>n-of-n</code> MuSig2 Bitcoin address.</p>
<h3 id="step-2-announcing-update-opportunities"><a class="header" href="#step-2-announcing-update-opportunities">Step 2: Announcing Update Opportunities</a></h3>
<p>After the <a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohort</a> is created, an <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> MAY choose between two flows for presenting and engaging with update opportunities:</p>
<ol>
<li>Pull Flow: <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> periodically announces update opportunities to <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a></li>
<li>Push Flow: <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> send updates to the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> when ready</li>
</ol>
<p>The cohort definition states which flow applies.</p>
<p>All <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> must be made aware of each opportunity because every participant must respond.</p>
<h4 id="respond-to-update-opportunities"><a class="header" href="#respond-to-update-opportunities">Respond to Update Opportunities</a></h4>
<p><a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> must submit a response to every update opportunity announced by the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a>; otherwise the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> cannot broadcast <a href="beacons/../terminology.html#beacon-signal">Beacon Signals</a>. This response must include:</p>
<ul>
<li>
<p>For a <a href="beacons/../terminology.html#cas-beacon">CAS Beacon</a>:</p>
<ul>
<li>Either a negative acknowledgement (for no update to be included)</li>
<li>Or …
<ul>
<li><code>did</code>: The DID to be updated.</li>
<li><code>updateHash</code>: The SHA-256 hash of the <a href="beacons/../terminology.html#btcr2-update">BTCR2 Update</a> to be included, created with the <a href="beacons/../algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm. (I.e., <code>json_document_hash(update)</code>)</li>
</ul>
</li>
<li>MuSig2 Nonce: A MuSig2 nonce constructed according to the nonce generation algorithm specified in [<a href="beacons/../bibliography.html#BIP327">BIP327</a>].</li>
</ul>
</li>
<li>
<p>For an <a href="beacons/../terminology.html#smt-beacon">SMT Beacon</a>:</p>
<ul>
<li><code>didIndex</code>: The SHA-256 hash of the DID to be updated.</li>
<li><code>updateHash</code>:
<ul>
<li>If there is an update:
<ul>
<li>If a <code>nonce</code> is used: <code>hash(hash(nonce) + json_document_hash(update))</code></li>
<li>If a <code>nonce</code> is not used: <code>json_document_hash(update)</code></li>
</ul>
</li>
<li>If there is not an update:
<ul>
<li>If a <code>nonce</code> is used: <code>hash(hash(nonce))</code></li>
<li>If a <code>nonce</code> is not used: <code>0</code></li>
</ul>
</li>
</ul>
</li>
<li>Participants MUST persist their <code>nonce</code> values.</li>
<li>MuSig2 Nonce: A MuSig2 nonce constructed according to the nonce generation algorithm specified in [<a href="beacons/../bibliography.html#BIP327">BIP327</a>].</li>
</ul>
</li>
</ul>
<p>This response SHOULD be sent over a secure communication channel and MAY be signed.</p>
<p>Once responses to an update opportunity are collected, the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> can prepare a candidate <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a> for confirmation by the cohort.</p>
<h3 id="step-3-aggregate--request-signal-confirmation"><a class="header" href="#step-3-aggregate--request-signal-confirmation">Step 3: Aggregate &amp; Request Signal Confirmation</a></h3>
<p>Once the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> has received responses to an update opportunity from all <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> in the <a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohort</a>, it aggregates the update announcements into an <a href="beacons/../terminology.html#unsigned-beacon-signal">Unsigned Beacon Signal</a>. All <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> MUST respond. The <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> needs every update/no-update decision and every MuSig2 nonce to build the complete signal payloads and the <code>n-of-n</code> aggregated nonce. It then sends this signal, along with the information required to confirm its construction, to each <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a>. The <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> also combines the MuSig2 nonces from each <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a> following the nonce aggregation algorithm in [<a href="beacons/../bibliography.html#BIP327">BIP327</a>].</p>
<p>Aggregation of updates into a <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a> depends on the type of <a href="beacons/../terminology.html#btcr2-beacon">BTCR2 Beacon</a>.</p>
<ul>
<li>
<p>For <a href="beacons/../terminology.html#cas-beacon">CAS Beacons</a>, the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> creates a <a href="beacons/../terminology.html#beacon-announcement-map">Beacon Announcement Map</a> that maps <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a>-provided indexes to <a href="beacons/../terminology.html#btcr2-update-announcement">BTCR2 Update Announcements</a>. The <a href="beacons/../terminology.html#signal-bytes">Signal Bytes</a> included in a CAS <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a> is the SHA-256 hash of the <a href="beacons/../terminology.html#beacon-announcement-map">Beacon Announcement Map</a>.</p>
</li>
<li>
<p>For <a href="beacons/../terminology.html#smt-beacon">SMT Beacons</a>, the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> constructs a <a href="beacons/../terminology.html#sparse-merkle-tree">Sparse Merkle Tree</a> (SMT) whose leaves pair each registered index with the value submitted for that index. Every registered index MUST appear as a leaf. After constructing the SMT, the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> optimizes the tree and generates <a href="beacons/../terminology.html#smt-proof">SMT Proofs</a> for each index to share with the corresponding <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a>. The <a href="beacons/../terminology.html#signal-bytes">Signal Bytes</a> of an SMT <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a> is the 32 byte SMT root.</p>
</li>
</ul>
<p>For a <a href="beacons/../terminology.html#cas-beacon">CAS Beacon</a>, the request signal confirmation message contains:</p>
<ul>
<li>The <a href="beacons/../terminology.html#beacon-announcement-map">Beacon Announcement Map</a>.</li>
<li>The <a href="beacons/../terminology.html#unsigned-beacon-signal">Unsigned Beacon Signal</a>.</li>
<li>The MuSig2 aggregated nonce.</li>
</ul>
<p>For an <a href="beacons/../terminology.html#smt-beacon">SMT Beacon</a>, the request signal confirmation message contains:</p>
<ul>
<li>An <a href="beacons/../terminology.html#smt-proof">SMT Proof</a> for each index belonging to the <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a>.</li>
<li>The <a href="beacons/../terminology.html#unsigned-beacon-signal">Unsigned Beacon Signal</a>.</li>
<li>The MuSig2 aggregated nonce.</li>
</ul>
<h4 id="confirm-signal-request"><a class="header" href="#confirm-signal-request">Confirm Signal Request</a></h4>
<p>The <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a> must validate the contents of the <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a> (partially signed transaction) according to the type of the <a href="beacons/../terminology.html#btcr2-beacon">BTCR2 Beacon</a>:</p>
<ul>
<li>
<p>For a <a href="beacons/../terminology.html#cas-beacon">CAS Beacon</a>, the <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a> checks that every registered index appears only when a <a href="beacons/../terminology.html#btcr2-update">BTCR2 Update</a> was submitted and that each mapped value matches the <a href="beacons/../terminology.html#btcr2-update-announcement">BTCR2 Update Announcements</a> they submitted. <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> MUST also check that the <a href="beacons/../terminology.html#signal-bytes">Signal Bytes</a> of the <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a> contains the SHA-256 hash of the <a href="beacons/../terminology.html#beacon-announcement-map">Beacon Announcement Map</a>.</p>
</li>
<li>
<p>For an <a href="beacons/../terminology.html#smt-beacon">SMT Beacon</a>, the <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a> validates that all the indexes registered with the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> have <a href="beacons/../terminology.html#smt-proof">SMT Proofs</a> and that the <a href="beacons/../terminology.html#smt-proof">SMT Proofs</a> are valid proofs of the values they submitted to the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a>. The <a href="beacons/../terminology.html#signal-bytes">Signal Bytes</a> in the <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a> MUST be used as the SMT root to verify these proofs.</p>
</li>
</ul>
<p>Once the <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participant</a> is satisfied that the <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a> only announces the <a href="beacons/../terminology.html#btcr2-update">BTCR2 Updates</a> they submitted for DIDs they control, they partially sign the Bitcoin transaction according to the signing algorithm specified in [<a href="beacons/../bibliography.html#BIP327">BIP327</a>]. <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> use the private key that matches the public key they provided when joining the <a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohort</a> and the MuSig2 aggregated nonce provided by the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a>. Finally, <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> return the partially signed Bitcoin transaction to the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a>, confirming the <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a>.</p>
<p><a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> SHOULD maintain the set of data required to validate their <a href="beacons/../terminology.html#btcr2-update">BTCR2 Updates</a> against the <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a>.</p>
<ul>
<li>For CAS <a href="beacons/../terminology.html#beacon-signal">Beacon Signals</a>, this means persisting the <a href="beacons/../terminology.html#beacon-announcement-map">Beacon Announcement Map</a> and the <a href="beacons/../terminology.html#btcr2-update">BTCR2 Updates</a> announced within that map for indexes that they control.</li>
<li>For SMT <a href="beacons/../terminology.html#beacon-signal">Beacon Signals</a>, <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> must persist the <a href="beacons/../terminology.html#btcr2-update">BTCR2 Updates</a>, nonce values, and <a href="beacons/../terminology.html#smt-proof">SMT Proofs</a> for each index they control.</li>
</ul>
<h3 id="step-4-broadcast-aggregated-signal"><a class="header" href="#step-4-broadcast-aggregated-signal">Step 4: Broadcast Aggregated Signal</a></h3>
<p>After the <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> receives confirmation of the <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a> from all <a href="beacons/../terminology.html#aggregation-participant">Aggregation Participants</a> within the <a href="beacons/../terminology.html#aggregation-cohort">Aggregation Cohort</a>, it finalizes the signature on the <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a>. Each confirmation contains a partial signature. The <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> aggregates these partial signatures to create a final signature that spends the <a href="beacons/../terminology.html#utxo">UTXO</a> controlled by the <a href="beacons/../terminology.html#beacon-address">Beacon Address</a> input in the <a href="beacons/../terminology.html#beacon-signal">Beacon Signal</a>.</p>
<p>Aggregation of partial signatures is done following the partial signature aggregation algorithm specified in [<a href="beacons/../bibliography.html#BIP327">BIP327</a>]. The result is a signed Bitcoin transaction. The <a href="beacons/../terminology.html#aggregation-service">Aggregation Service</a> then broadcasts this transaction onto the Bitcoin network.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data-structures"><a class="header" href="#data-structures">Data Structures</a></h1>
<p>For the purposes of interoperability, this specification defines data structures using the data
model defined by the DID core v1.1 specification [<a href="bibliography.html#DID-CORE">DID-CORE</a>].</p>
<p>Concrete representations of these data structures MUST conform to the JSON-LD 1.1 specification [<a href="bibliography.html#JSON-LD">JSON-LD</a>].</p>
<p>All SHA-256 hashes [<a href="bibliography.html#SHA256">SHA256</a>] that appear in concrete representations of these data structures
MUST be encoded as a string using the <code>"base64url"</code> [<a href="bibliography.html#RFC4648">RFC4648</a>] encoding.</p>
<h2 id="did-document"><a class="header" href="#did-document">DID Document</a></h2>
<p>A DID document is a map data structure defined by the DID core v1.1 specification [<a href="bibliography.html#DID-CORE">DID-CORE</a>].</p>
<p>The following properties MUST be included:</p>
<ul>
<li><code>@context</code>: A context array containing the following context URLs:
<ul>
<li><code>"https://www.w3.org/TR/did-1.1"</code></li>
<li><code>"https://btcr2.dev/context/v1"</code></li>
</ul>
</li>
<li><code>id</code>: The <code>did</code>.</li>
</ul>
<p>It can optionally include one or more of the following properties:</p>
<ul>
<li><code>verificationMethod</code>: A set of verification method objects.</li>
<li><code>assertionMethod</code>: A set of references to verification methods or embedded verification method
objects to be used for assertions.</li>
<li><code>capabilityInvocation</code>: A set of references to verification methods or embedded verification
method objects to be used for capability invocations.</li>
<li><code>service</code>: An array of service objects.
<ul>
<li><a href="./terminology.html#btcr2-beacon">BTCR2 Beacons</a> are declared as DID services using the service <code>type</code> specified in
<a href="./beacons.html#beacon-types">Beacons Table 1: Beacon Types</a>.</li>
</ul>
</li>
</ul>
<p>In order for this DID document to be updatable, controllers must include at least one
verification method with a capability invocation verification relationship and at least one
<a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a> service.</p>
<h2 id="genesis-document"><a class="header" href="#genesis-document">Genesis Document</a></h2>
<p>A <a href="./terminology.html#genesis-document">Genesis Document</a> is a <a href="./data-structures.html#did-document">DID document (data structure)</a> with the identifier set to the
placeholder value (<code>did:btcr2:_</code>).</p>
<div class="tabs" id="genesis-document-example">
  <div class="tablist" role="tablist" aria-label="genesis-document-example">
    <button role="tab"
            id="genesis-document-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="genesis-document-example-panel-hide"
            data-tab="genesis-document-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="genesis-document-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="genesis-document-example-panel-show"
            data-tab="genesis-document-example-panel-show">
Show Example
    </button>
  </div>
  <section id="genesis-document-example-panel-hide"
           role="tabpanel"
           aria-labelledby="genesis-document-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="genesis-document-example-panel-show"
           role="tabpanel"
           aria-labelledby="genesis-document-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "@context": [
    "https://www.w3.org/TR/did-1.1",
    "https://btcr2.dev/context/v1"
  ],
  "id": "did:btcr2:_",
  "verificationMethod": [
    {
      "id": "did:btcr2:_#key-0",
      "type": "Multikey",
      "controller": "did:btcr2:_",
      "publicKeyMultibase": "zQ3shSnvxNK94Kpux1sp8RCWfn4dTFcAr1fZLf7E3Dy19mEBi"
    }
  ],
  "assertionMethod": [
    "did:btcr2:_#key-0"
  ],
  "capabilityInvocation": [
    "did:btcr2:_#key-0"
  ],
  "service": [
    {
      "id": "did:btcr2:_#service-0",
      "type": "SingletonBeacon",
      "serviceEndpoint": "bitcoin:tb1qtmshuqzeyr7cdh5t2nl6kf3s73fdynpj5apgtx"
    },
    {
      "id": "did:btcr2:_#service-1",
      "type": "MapBeacon",
      "serviceEndpoint": "bitcoin:tb1pt97580gtfuge9mnrkvj2upk982alrr08pk4hhmlzkeutc06pt9pqyjqef2"
    },
    {
      "id": "did:btcr2:_#service-2",
      "type": "SMTBeacon",
      "serviceEndpoint": "bitcoin:tb1pgrn7wxhtlsakjjelag6usrmzw89h8tnsaq2ly50ty29hujerqu0sk5kv4e"
    }
  ]
}
</code></pre>
  </section>
</div>
<h2 id="initial-document"><a class="header" href="#initial-document">Initial DID Document</a></h2>
<p>An <a href="./terminology.html#initial-did-document">Initial DID Document</a> is a conformant <a href="./data-structures.html#did-document">DID document (data structure)</a>.</p>
<div class="tabs" id="initial-did-document-example">
  <div class="tablist" role="tablist" aria-label="initial-did-document-example">
    <button role="tab"
            id="initial-did-document-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="initial-did-document-example-panel-hide"
            data-tab="initial-did-document-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="initial-did-document-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="initial-did-document-example-panel-show"
            data-tab="initial-did-document-example-panel-show">
Show Example
    </button>
  </div>
  <section id="initial-did-document-example-panel-hide"
           role="tabpanel"
           aria-labelledby="initial-did-document-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="initial-did-document-example-panel-show"
           role="tabpanel"
           aria-labelledby="initial-did-document-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "@context": [
    "https://www.w3.org/TR/did-1.1",
    "https://btcr2.dev/context/v1"
  ],
  "id": "did:btcr2:k1q5pvh5zask8khdg7p58ygveewkcufetu3dlqyaca5dzqct6mjhf540qhrxgv3",
  "controller": [
    "did:btcr2:k1q5pvh5zask8khdg7p58ygveewkcufetu3dlqyaca5dzqct6mjhf540qhrxgv3"
  ],
  "verificationMethod": [
    {
      "id": "did:btcr2:k1q5pvh5zask8khdg7p58ygveewkcufetu3dlqyaca5dzqct6mjhf540qhrxgv3#initialKey",
      "type": "Multikey",
      "controller": "did:btcr2:k1q5pvh5zask8khdg7p58ygveewkcufetu3dlqyaca5dzqct6mjhf540qhrxgv3",
      "publicKeyMultibase": "zQ3shb8PoGykqRtHb9bXNKrXG7PHMjDrECcgLeSqawMERFACj"
    }
  ],
  "authentication": [
    "did:btcr2:k1q5pvh5zask8khdg7p58ygveewkcufetu3dlqyaca5dzqct6mjhf540qhrxgv3#initialKey"
  ],
  "assertionMethod": [
    "did:btcr2:k1q5pvh5zask8khdg7p58ygveewkcufetu3dlqyaca5dzqct6mjhf540qhrxgv3#initialKey"
  ],
  "capabilityInvocation": [
    "did:btcr2:k1q5pvh5zask8khdg7p58ygveewkcufetu3dlqyaca5dzqct6mjhf540qhrxgv3#initialKey"
  ],
  "capabilityDelegation": [
    "did:btcr2:k1q5pvh5zask8khdg7p58ygveewkcufetu3dlqyaca5dzqct6mjhf540qhrxgv3#initialKey"
  ],
  "service": [
    {
      "type": "SingletonBeacon",
      "id": "did:btcr2:k1q5pvh5zask8khdg7p58ygveewkcufetu3dlqyaca5dzqct6mjhf540qhrxgv3#initialP2PKH",
      "serviceEndpoint": "bitcoin:mzCTywak2t3ZGf1jMCF8UrsH2jWLwh9zJL"
    },
    {
      "type": "SingletonBeacon",
      "id": "did:btcr2:k1q5pvh5zask8khdg7p58ygveewkcufetu3dlqyaca5dzqct6mjhf540qhrxgv3#initialP2WPKH",
      "serviceEndpoint": "bitcoin:tb1qen45fjp5r57v7x99ww3cpkd9argdkvgadrayfw"
    },
    {
      "type": "SingletonBeacon",
      "id": "did:btcr2:k1q5pvh5zask8khdg7p58ygveewkcufetu3dlqyaca5dzqct6mjhf540qhrxgv3#initialP2TR",
      "serviceEndpoint": "bitcoin:tb1p6efm2xk7mpfmh733qyu3k7cgk05gmyynp49srgn7u5uqxsr8avssj4rdlc"
    }
  ]
}
</code></pre>
  </section>
</div>
<h2 id="btcr2-unsigned-update"><a class="header" href="#btcr2-unsigned-update">BTCR2 Unsigned Update</a></h2>
<p>A <a href="./terminology.html#btcr2-unsigned-update">BTCR2 Unsigned Update</a> is a Map data structure with the following properties:</p>
<ul>
<li><code>@context</code>: A context array containing the following context URLs:
<ul>
<li><code>"https://w3id.org/zcap/v1"</code></li>
<li><code>"https://w3id.org/security/data-integrity/v2"</code></li>
<li><code>"https://w3id.org/json-ld-patch/v1"</code></li>
<li><code>"https://btcr2.dev/context/v1"</code></li>
</ul>
</li>
<li><code>patch</code>: A JSON Patch [<a href="bibliography.html#RFC6902">RFC6902</a>] object that defines a set of transformations to be
applied to a DID document. The result of applying the patch MUST be a conformant DID document
according to the DID core v1.1 specification [<a href="bibliography.html#DID-CORE">DID-CORE</a>].</li>
<li><code>targetVersionId</code>: The <code>versionId</code> of the DID document after the patch has been applied. The
targetVersionId MUST be one more than the <code>versionId</code> of the DID document being updated.</li>
<li><code>sourceHash</code>: A SHA-256 hash of the DID document that the patch MUST be applied to. The hash MUST
be produced by the <a href="./algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm.</li>
<li><code>targetHash</code>: A SHA-256 hash of the DID document that results from applying the patch to the
source document. The hash MUST be produced by the <a href="./algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm.</li>
</ul>
<div class="tabs" id="btcr2-unsigned-update-example">
  <div class="tablist" role="tablist" aria-label="btcr2-unsigned-update-example">
    <button role="tab"
            id="btcr2-unsigned-update-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="btcr2-unsigned-update-example-panel-hide"
            data-tab="btcr2-unsigned-update-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="btcr2-unsigned-update-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="btcr2-unsigned-update-example-panel-show"
            data-tab="btcr2-unsigned-update-example-panel-show">
Show Example
    </button>
  </div>
  <section id="btcr2-unsigned-update-example-panel-hide"
           role="tabpanel"
           aria-labelledby="btcr2-unsigned-update-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="btcr2-unsigned-update-example-panel-show"
           role="tabpanel"
           aria-labelledby="btcr2-unsigned-update-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "@context": [
    "https://w3id.org/security/v2",
    "https://w3id.org/zcap/v1",
    "https://w3id.org/json-ld-patch/v1",
    "https://btcr2.dev/context/v1"
  ],
  "patch": [
    {
      "op": "add",
      "path": "/verificationMethod/1",
      "value": {
        "id": "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54#key-1",
        "type": "Multikey",
        "controller": "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54",
        "publicKeyMultibase": "zQ3shSnvxNK94Kpux1sp8RCWfn4dTFcAr1fZLf7E3Dy19mEBi"
      }
    },
    {
      "op": "add",
      "path": "/authentication",
      "value": [
        "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54#key-1"
      ]
    }
  ],
  "sourceHash": "8beuAJ8w88YWrms8hsqCnZn2atxBMGsQ7YBFhzPx5b2q",
  "targetHash": "F2F1pmK9tWAwzf6rKyVCietbswatFctvSJHM4sj1fiAw",
  "targetVersionId": 2
}
</code></pre>
  </section>
</div>
<h2 id="btcr2-signed-update"><a class="header" href="#btcr2-signed-update">BTCR2 Signed Update</a></h2>
<p>A <a href="./terminology.html#btcr2-signed-update">BTCR2 Signed Update</a> is a Map data structure with the same properties as
<a href="./data-structures.html#btcr2-unsigned-update">BTCR2 Unsigned Update (data structure)</a> and one additional property:</p>
<ul>
<li><code>proof</code>: A <a href="./data-structures.html#data-integrity-proof">Data Integrity Proof (data structure)</a>.</li>
</ul>
<div class="tabs" id="btcr2-signed-update-example">
  <div class="tablist" role="tablist" aria-label="btcr2-signed-update-example">
    <button role="tab"
            id="btcr2-signed-update-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="btcr2-signed-update-example-panel-hide"
            data-tab="btcr2-signed-update-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="btcr2-signed-update-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="btcr2-signed-update-example-panel-show"
            data-tab="btcr2-signed-update-example-panel-show">
Show Example
    </button>
  </div>
  <section id="btcr2-signed-update-example-panel-hide"
           role="tabpanel"
           aria-labelledby="btcr2-signed-update-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="btcr2-signed-update-example-panel-show"
           role="tabpanel"
           aria-labelledby="btcr2-signed-update-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "@context": [
    "https://w3id.org/security/v2",
    "https://w3id.org/zcap/v1",
    "https://w3id.org/json-ld-patch/v1",
    "https://btcr2.dev/context/v1"
  ],
  "patch": [
    {
      "op": "add",
      "path": "/verificationMethod/1",
      "value": {
        "id": "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54#key-1",
        "type": "Multikey",
        "controller": "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54",
        "publicKeyMultibase": "zQ3shSnvxNK94Kpux1sp8RCWfn4dTFcAr1fZLf7E3Dy19mEBi"
      }
    },
    {
      "op": "add",
      "path": "/authentication",
      "value": [
        "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54#key-1"
      ]
    }
  ],
  "sourceHash": "8beuAJ8w88YWrms8hsqCnZn2atxBMGsQ7YBFhzPx5b2q",
  "targetHash": "F2F1pmK9tWAwzf6rKyVCietbswatFctvSJHM4sj1fiAw",
  "targetVersionId": 2,
  "proof": {
    "@context": [
      "https://w3id.org/security/v2",
      "https://w3id.org/zcap/v1",
      "https://w3id.org/json-ld-patch/v1",
      "https://btcr2.dev/context/v1"
    ],
    "type": "DataIntegrityProof",
    "cryptosuite": "bip340-jcs-2025",
    "verificationMethod": "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54#key-0",
    "proofPurpose": "capabilityInvocation",
    "capability": "urn:zcap:root:did%3Abtcr2%3Ax1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54",
    "capabilityAction": "Write",
    "proofValue": "zNgANukLD9rKeH7PDcwNaNmRyGWo8wYBNaFE7xmGx6erWPGNzKKNH7ZXG8EwLRaK3EfpJ5o3F6ab8gLzWAZYrZL4"
  }
}
</code></pre>
  </section>
</div>
<h2 id="data-integrity-config"><a class="header" href="#data-integrity-config">Data Integrity Config</a></h2>
<p>A Data Integrity [<a href="bibliography.html#VC-DATA-INTEGRITY">VC-DATA-INTEGRITY</a>] proof with the <code>proofPurpose</code> set to <code>"capabilityInvocation"</code> and <code>proofValue</code> omitted.</p>
<p>The following properties MUST be included in the Data Integrity Config:</p>
<ul>
<li><code>@context</code>: A context array containing the follow context URLs:
<ul>
<li><code>"https://w3id.org/security/v2"</code></li>
<li><code>"https://w3id.org/zcap/v1"</code></li>
<li><code>"https://w3id.org/json-ld-patch/v1"</code></li>
<li><code>"https://btcr2.dev/context/v1"</code></li>
</ul>
</li>
<li><code>type</code>: The string <code>"DataIntegrityProof"</code>.</li>
<li><code>cryptosuite</code>: The string <code>"bip340-jcs-2025"</code>.</li>
<li><code>verificationMethod</code>: A valid <code>verificationMethod</code> reference that exists in the most recent DID document.</li>
<li><code>proofPurpose</code>: The string <code>"capabilityInvocation"</code>.</li>
<li><code>capability</code>: A URN of the following format: <code>urn:zcap:root:${encodeURIComponent(did)}</code>.</li>
<li><code>capabilityAction</code>: A string declaring the action required for the capability invocation. The
string MUST be set to <code>"Write"</code>.</li>
</ul>
<div class="tabs" id="data-integrity-config-example">
  <div class="tablist" role="tablist" aria-label="data-integrity-config-example">
    <button role="tab"
            id="data-integrity-config-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="data-integrity-config-example-panel-hide"
            data-tab="data-integrity-config-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="data-integrity-config-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="data-integrity-config-example-panel-show"
            data-tab="data-integrity-config-example-panel-show">
Show Example
    </button>
  </div>
  <section id="data-integrity-config-example-panel-hide"
           role="tabpanel"
           aria-labelledby="data-integrity-config-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="data-integrity-config-example-panel-show"
           role="tabpanel"
           aria-labelledby="data-integrity-config-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "@context": [
    "https://w3id.org/security/v2",
    "https://w3id.org/zcap/v1",
    "https://w3id.org/json-ld-patch/v1",
    "https://btcr2.dev/context/v1"
  ],
  "type": "DataIntegrityProof",
  "cryptosuite": "bip340-jcs-2025",
  "verificationMethod": "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54#key-0",
  "proofPurpose": "capabilityInvocation",
  "capability": "urn:zcap:root:did%3Abtcr2%3Ax1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54",
  "capabilityAction": "Write"
}
</code></pre>
  </section>
</div>
<h2 id="data-integrity-proof"><a class="header" href="#data-integrity-proof">Data Integrity Proof</a></h2>
<p>A <a href="./terminology.html#data-integrity-proof">Data Integrity Proof</a> with the <code>proofPurpose</code> set to <code>"capabilityInvocation"</code>. This proof MUST be a valid invocation of the capability to update a <strong>did:btcr2</strong> DID document.</p>
<p>This data structure is a Map data structure with the same properties as <a href="./data-structures.html#data-integrity-config">Data Integrity Config (data structure)</a> and one additional property:</p>
<ul>
<li><code>proofValue</code>: MUST be a detached Schnorr signature produced according to Schnorr Signatures for secp256k1 [<a href="bibliography.html#BIP340">BIP340</a>], as a Multibase <code>"base-58-btc"</code> [<a href="bibliography.html#CID">CID</a>] encoded string.</li>
</ul>
<div class="tabs" id="data-integrity-proof-example">
  <div class="tablist" role="tablist" aria-label="data-integrity-proof-example">
    <button role="tab"
            id="data-integrity-proof-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="data-integrity-proof-example-panel-hide"
            data-tab="data-integrity-proof-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="data-integrity-proof-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="data-integrity-proof-example-panel-show"
            data-tab="data-integrity-proof-example-panel-show">
Show Example
    </button>
  </div>
  <section id="data-integrity-proof-example-panel-hide"
           role="tabpanel"
           aria-labelledby="data-integrity-proof-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="data-integrity-proof-example-panel-show"
           role="tabpanel"
           aria-labelledby="data-integrity-proof-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "@context": [
    "https://w3id.org/security/v2",
    "https://w3id.org/zcap/v1",
    "https://w3id.org/json-ld-patch/v1",
    "https://btcr2.dev/context/v1"
  ],
  "type": "DataIntegrityProof",
  "cryptosuite": "bip340-jcs-2025",
  "verificationMethod": "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54#key-0",
  "proofPurpose": "capabilityInvocation",
  "capability": "urn:zcap:root:did%3Abtcr2%3Ax1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54",
  "capabilityAction": "Write",
  "proofValue": "zNgANukLD9rKeH7PDcwNaNmRyGWo8wYBNaFE7xmGx6erWPGNzKKNH7ZXG8EwLRaK3EfpJ5o3F6ab8gLzWAZYrZL4"
}
</code></pre>
  </section>
</div>
<h2 id="sidecar-data"><a class="header" href="#sidecar-data">Sidecar Data</a></h2>
<p>The <a href="./terminology.html#sidecar-data">Sidecar Data</a> contains optional properties:</p>
<ul>
<li><code>@context</code>: The context string <code>"https://btcr2.dev/context/v1"</code></li>
<li><code>genesisDocument</code>: OPTIONAL <a href="./terminology.html#genesis-document">Genesis Document</a>. It is REQUIRED when resolving <strong>did:btcr2</strong>
identifiers with <code>x</code> HRP.</li>
<li><code>updates</code>: OPTIONAL array of <a href="./terminology.html#btcr2-signed-update">BTCR2 Signed Updates</a>. It is REQUIRED
if the DID being resolved has ever had a published <a href="./terminology.html#btcr2-update">BTCR2 Update</a>.</li>
<li><code>casUpdates</code>: OPTIONAL array of <a href="./data-structures.html#cas-announcement">CAS Announcements</a>. It is REQUIRED
if the DID being resolved has used a <a href="./terminology.html#cas-beacon">CAS Beacon</a> to publish a <a href="./terminology.html#btcr2-update">BTCR2 Update</a>.</li>
<li><code>smtProofs</code>: OPTIONAL array of <a href="./data-structures.html#smt-proof">SMT Proofs</a>. It is REQUIRED
if the DID being resolved has used a <a href="./terminology.html#smt-beacon">SMT Beacon</a> to publish a <a href="./terminology.html#btcr2-update">BTCR2 Update</a>.</li>
</ul>
<div class="tabs" id="sidecar-data-example">
  <div class="tablist" role="tablist" aria-label="sidecar-data-example">
    <button role="tab"
            id="sidecar-data-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="sidecar-data-example-panel-hide"
            data-tab="sidecar-data-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="sidecar-data-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="sidecar-data-example-panel-show"
            data-tab="sidecar-data-example-panel-show">
Show Example
    </button>
  </div>
  <section id="sidecar-data-example-panel-hide"
           role="tabpanel"
           aria-labelledby="sidecar-data-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="sidecar-data-example-panel-show"
           role="tabpanel"
           aria-labelledby="sidecar-data-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "@context": "https://btcr2.dev/context/v1",
  "updates": [
    {
      "@context": [
        "https://w3id.org/security/v2",
        "https://w3id.org/zcap/v1",
        "https://w3id.org/json-ld-patch/v1"
      ],
      "patch": [
        {
          "op": "add",
          "path": "/verificationMethod/1",
          "value": {
            "id": "did:btcr2:k1q5pa5tq86fzrl0ez32nh8e0ks4tzzkxnnmn8tdvxk04ahzt70u09dag02h0cp#key-1",
            "type": "Multikey",
            "controller": "did:btcr2:k1q5pa5tq86fzrl0ez32nh8e0ks4tzzkxnnmn8tdvxk04ahzt70u09dag02h0cp",
            "publicKeyMultibase": "zQ3shnJ534uiR8xHXZuumXDDeAYwJhkTbiyYcaFSbwWxCnpXT"
          }
        }
      ],
      "sourceHash": "8SZT2CphokAD389BtLmn5DGY6QUbM5QBSnFqpdzAwdaU",
      "targetHash": "3YgLJ5dshQzrfy3ZjiH6TFWtwjQP8XGirjzT5ysmTh5m",
      "targetVersionId": 2,
      "proof": {
        "@context": [
          "https://w3id.org/security/v2",
          "https://w3id.org/zcap/v1",
          "https://w3id.org/json-ld-patch/v1"
        ],
        "type": "DataIntegrityProof",
        "cryptosuite": "bip340-jcs-2025",
        "verificationMethod": "did:btcr2:k1q5pa5tq86fzrl0ez32nh8e0ks4tzzkxnnmn8tdvxk04ahzt70u09dag02h0cp#initialKey",
        "proofPurpose": "capabilityInvocation",
        "capability": "urn:zcap:root:did%3Abtcr2%3Ak1q5pa5tq86fzrl0ez32nh8e0ks4tzzkxnnmn8tdvxk04ahzt70u09dag02h0cp",
        "capabilityAction": "Write",
        "proofValue": "z2mEjk9a1cgm9KZyo16heWmuoSV9TZYaQmuKkJMoh4pvFYhQnaz18WAWNv98MQ9xqbWa95rYoMCvEy5c2wc2yaFYg"
      }
    },
    {
      "@context": [
        "https://w3id.org/security/v2",
        "https://w3id.org/zcap/v1",
        "https://w3id.org/json-ld-patch/v1"
      ],
      "patch": [
        {
          "op": "add",
          "path": "/service/3",
          "value": {
            "id": "did:btcr2:k1q5pa5tq86fzrl0ez32nh8e0ks4tzzkxnnmn8tdvxk04ahzt70u09dag02h0cp#service-3",
            "type": "SingletonBeacon",
            "serviceEndpoint": "bitcoin:tb1qcs60r4j6ema8x4gf07hgt83x45e650dr97q3qv"
          }
        }
      ],
      "sourceHash": "3YgLJ5dshQzrfy3ZjiH6TFWtwjQP8XGirjzT5ysmTh5m",
      "targetHash": "GceTr5Ac4c3LK4uySTtiyBm2W7bmQHAsNCbGKbeNCAgg",
      "targetVersionId": 3,
      "proof": {
        "@context": [
          "https://w3id.org/security/v2",
          "https://w3id.org/zcap/v1",
          "https://w3id.org/json-ld-patch/v1"
        ],
        "type": "DataIntegrityProof",
        "cryptosuite": "bip340-jcs-2025",
        "verificationMethod": "did:btcr2:k1q5pa5tq86fzrl0ez32nh8e0ks4tzzkxnnmn8tdvxk04ahzt70u09dag02h0cp#initialKey",
        "proofPurpose": "capabilityInvocation",
        "capability": "urn:zcap:root:did%3Abtcr2%3Ak1q5pa5tq86fzrl0ez32nh8e0ks4tzzkxnnmn8tdvxk04ahzt70u09dag02h0cp",
        "capabilityAction": "Write",
        "proofValue": "z4WtnwesES1oTXLDPTJdwQEAkvStsWKxW8FFbnKt2SRh6QRdcGFk5DiEdG7QWoVDXqCRX3FpgrrTKhebEnuLHxbrf"
      }
    }
  ],
  "casUpdates": [
    {
      "did:btcr2:k1q5pa5tq86fzrl0ez32nh8e0ks4tzzkxnnmn8tdvxk04ahzt70u09dag02h0cp": "a4ayc_80_OGda4BO_1o_V0etpOqiLx1JwB5S3beHW0s",
      "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54": "1HNeOiZeFu7gP1lxi5tdAwGcB9i2xR-Q2jpmbuwTqzU",
      "did:btcr2:k1qgp5h79scv4sfqkzak5g6y89dsy3cq0pd2nussu2cm3zjfhn4ekwrucc4q7t7": "TgdAhWK-24tgzgXB3s_jrRa3IjCWfeAfZAt-Rym0n84"
    },
    {
      "did:btcr2:k1q5pa5tq86fzrl0ez32nh8e0ks4tzzkxnnmn8tdvxk04ahzt70u09dag02h0cp": "SyJ3d9TdH8Ycb4hPSGQdArTRIdP9Moywi1Ux_Kzav4o",
      "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54": "7y0SfeN7lCuq0GFF5UsMYZofIjJ7LrvPvsePVWSv450"
    }
  ]
}
</code></pre>
  </section>
</div>
<h2 id="smt-proof"><a class="header" href="#smt-proof">SMT Proof</a></h2>
<p>An <a href="./terminology.html#smt-proof">SMT Proof</a> data structure contains the following properties:</p>
<ul>
<li><code>id</code>: SHA-256 hash of the root node.</li>
<li><code>nonce</code>: OPTIONAL 256-bit nonce generated for each update. MUST be encoded as a string using the <code>"base64url"</code> [<a href="bibliography.html#RFC4648">RFC4648</a>] encoding.</li>
<li><code>updateId</code>: The OPTIONAL <a href="./data-structures.html#btcr2-signed-update">BTCR2 Signed Update (data structure)</a> hashed with the <a href="./algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm.</li>
<li><code>collapsed</code>: Bitmap of zero nodes within the path (see: <a href="https://github.com/hoytech/quadrable#collapsed-leaves">collapsed leaves</a>).</li>
<li><code>hashes</code>: Array of SHA-256 hashes representing the sibling <a href="./terminology.html#smt">SMT</a> nodes from the leaf, containing the SHA-256 hash of the <a href="./terminology.html#btcr2-signed-update">BTCR2 Signed Update</a> or the “zero identity”, to the root.</li>
</ul>
<div class="tabs" id="sidecar-smt-proof-example">
  <div class="tablist" role="tablist" aria-label="sidecar-smt-proof-example">
    <button role="tab"
            id="sidecar-smt-proof-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="sidecar-smt-proof-example-panel-hide"
            data-tab="sidecar-smt-proof-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="sidecar-smt-proof-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="sidecar-smt-proof-example-panel-show"
            data-tab="sidecar-smt-proof-example-panel-show">
Show Example
    </button>
  </div>
  <section id="sidecar-smt-proof-example-panel-hide"
           role="tabpanel"
           aria-labelledby="sidecar-smt-proof-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="sidecar-smt-proof-example-panel-show"
           role="tabpanel"
           aria-labelledby="sidecar-smt-proof-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "id": "&lt;&lt; Hexadecimal of Root Hash &gt;&gt;",
  "nonce": "&lt;&lt; Hexadecimal of Nonce 1101 &gt;&gt;",
  "updateId": "&lt;&lt; Hexadecimal of hash(Data Block 1101) &gt;&gt;",
  "collapsed": "&lt;&lt; Hexadecimal of 0001 &gt;&gt;",
  "hashes": [
      "&lt;&lt; Hexadecimal of Hash 1110 &gt;&gt;",
      "&lt;&lt; Hexadecimal of Hash 1001 &gt;&gt;",
      "&lt;&lt; Hexadecimal of Hash 0 &gt;&gt;"
  ]
}
</code></pre>
  </section>
</div>
<h2 id="resolution-options"><a class="header" href="#resolution-options">Resolution Options</a></h2>
<p>This data structure is defined by DID Resolution v0.3 [<a href="bibliography.html#DID-RESOLUTION">DID-RESOLUTION</a>].</p>
<p>Resolution options MAY contain the following properties:</p>
<ul>
<li><code>versionId</code>: OPTIONAL ASCII string representation of the specific version of a DID document to be resolved.</li>
<li><code>versionTime</code>: OPTIONAL XML Datetime normalized to UTC without sub-second decimal precision. The DID document to be resolved is the most recent version of the DID document that was valid for the DID before the specified <code>versionTime</code>.</li>
<li><code>sidecar</code>: <a href="./data-structures.html#sidecar-data">Sidecar Data (data structure)</a>.</li>
</ul>
<div class="tabs" id="resolution-options-example">
  <div class="tablist" role="tablist" aria-label="resolution-options-example">
    <button role="tab"
            id="resolution-options-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="resolution-options-example-panel-hide"
            data-tab="resolution-options-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="resolution-options-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="resolution-options-example-panel-show"
            data-tab="resolution-options-example-panel-show">
Show Example
    </button>
  </div>
  <section id="resolution-options-example-panel-hide"
           role="tabpanel"
           aria-labelledby="resolution-options-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="resolution-options-example-panel-show"
           role="tabpanel"
           aria-labelledby="resolution-options-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "versionId": "4",
  "versionTime": "2025-01-05T12:00:00Z",
  "sidecar": {
    "@context": "https://btcr2.dev/context/v1",
    "genesisDocument": {
      "@context": [
        "https://www.w3.org/TR/did-1.1",
        "https://btcr2.dev/context/v1"
      ],
      "id": "did:btcr2:_",
      "verificationMethod": [
        {
          "id": "did:btcr2:_#initialKey",
          "type": "Multikey",
          "controller": "did:btcr2:_",
          "publicKeyMultibase": "zQ3shb8PoGykqRtHb9bXNKrXG7PHMjDrECcgLeSqawMERFACj"
        }
      ],
      "capabilityInvocation": [
        "did:btcr2:_#initialKey"
      ],
      "service": [
        {
          "type": "SingletonBeacon",
          "id": "did:btcr2:_#initialP2TR",
          "serviceEndpoint": "bitcoin:tb1p6efm2xk7mpfmh733qyu3k7cgk05gmyynp49srgn7u5uqxsr8avssj4rdlc"
        }
      ]
    },
    "updates": [],
    "casUpdates": [],
    "smtProofs": []
  }
}
</code></pre>
  </section>
</div>
<h2 id="did-resolution-metadata"><a class="header" href="#did-resolution-metadata">DID Resolution Metadata</a></h2>
<p>This data structure is defined by DID Resolution v0.3 [<a href="bibliography.html#DID-RESOLUTION">DID-RESOLUTION</a>].</p>
<p>Resolution metadata MAY contain the following properties:</p>
<ul>
<li><code>contentType</code>: OPTIONAL media type of the returned DID document. E.g., <code>"application/ld+json"</code>.</li>
<li><code>error</code>: REQUIRED if an error occurs during DID resolution.</li>
</ul>
<div class="tabs" id="did-resolution-metadata-example">
  <div class="tablist" role="tablist" aria-label="did-resolution-metadata-example">
    <button role="tab"
            id="did-resolution-metadata-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="did-resolution-metadata-example-panel-hide"
            data-tab="did-resolution-metadata-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="did-resolution-metadata-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="did-resolution-metadata-example-panel-show"
            data-tab="did-resolution-metadata-example-panel-show">
Show Example
    </button>
  </div>
  <section id="did-resolution-metadata-example-panel-hide"
           role="tabpanel"
           aria-labelledby="did-resolution-metadata-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="did-resolution-metadata-example-panel-show"
           role="tabpanel"
           aria-labelledby="did-resolution-metadata-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "contentType": "application/did+ld+json"
}
</code></pre>
  </section>
</div>
<h2 id="did-document-metadata"><a class="header" href="#did-document-metadata">DID Document Metadata</a></h2>
<p>This data structure is defined by DID Resolution v0.3 [<a href="bibliography.html#DID-RESOLUTION">DID-RESOLUTION</a>].</p>
<p>Document metadata MAY contain the following properties:</p>
<ul>
<li><code>deactivated</code>: REQUIRED boolean that represents whether the resolved DID document has been deactivated.</li>
<li><code>updated</code>: OPTIONAL XML Datetime normalized to UTC without sub-second decimal precision of the last Update operation for the resolved DID document.</li>
<li><code>versionId</code>: OPTIONAL ASCII string representation of the version of the last Update operation for the resolved DID document.</li>
</ul>
<div class="tabs" id="did-document-metadata-example">
  <div class="tablist" role="tablist" aria-label="did-document-metadata-example">
    <button role="tab"
            id="did-document-metadata-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="did-document-metadata-example-panel-hide"
            data-tab="did-document-metadata-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="did-document-metadata-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="did-document-metadata-example-panel-show"
            data-tab="did-document-metadata-example-panel-show">
Show Example
    </button>
  </div>
  <section id="did-document-metadata-example-panel-hide"
           role="tabpanel"
           aria-labelledby="did-document-metadata-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="did-document-metadata-example-panel-show"
           role="tabpanel"
           aria-labelledby="did-document-metadata-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "deactivated": false,
  "updated": "2025-01-06T16:23:10Z",
  "versionId": "5"
}
</code></pre>
  </section>
</div>
<h2 id="cas-announcement"><a class="header" href="#cas-announcement">CAS Announcement</a></h2>
<p>A data structure that maps DIDs to <a href="./terminology.html#btcr2-signed-update">BTCR2 Signed Update</a> hashes. All <a href="./data-structures.html#btcr2-signed-update">BTCR2 Signed Updates (data structure)</a> MUST be hashed with the <a href="./algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm. The concrete representation of this data structure will be published to a <a href="./terminology.html#cas">CAS</a>.</p>
<div class="tabs" id="cas-announcement-example">
  <div class="tablist" role="tablist" aria-label="cas-announcement-example">
    <button role="tab"
            id="cas-announcement-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="cas-announcement-example-panel-hide"
            data-tab="cas-announcement-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="cas-announcement-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="cas-announcement-example-panel-show"
            data-tab="cas-announcement-example-panel-show">
Show Example
    </button>
  </div>
  <section id="cas-announcement-example-panel-hide"
           role="tabpanel"
           aria-labelledby="cas-announcement-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="cas-announcement-example-panel-show"
           role="tabpanel"
           aria-labelledby="cas-announcement-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "did:btcr2:k1q5pa5tq86fzrl0ez32nh8e0ks4tzzkxnnmn8tdvxk04ahzt70u09dag02h0cp": "a4ayc_80_OGda4BO_1o_V0etpOqiLx1JwB5S3beHW0s",
  "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54": "1HNeOiZeFu7gP1lxi5tdAwGcB9i2xR-Q2jpmbuwTqzU",
  "did:btcr2:k1qgp5h79scv4sfqkzak5g6y89dsy3cq0pd2nussu2cm3zjfhn4ekwrucc4q7t7": "TgdAhWK-24tgzgXB3s_jrRa3IjCWfeAfZAt-Rym0n84"
}
</code></pre>
  </section>
</div>
<h2 id="root-capability"><a class="header" href="#root-capability">Root Capability</a></h2>
<p>A Root Capability is an Object Capability used to authorize updates to a DID document. Implementation MAY use ZCAP-LD for capability invocations [<a href="bibliography.html#ZCAP-LD">ZCAP-LD</a>].</p>
<p>The Root Capability MUST be a map containing only the following properties:</p>
<ul>
<li><code>@context</code>: MUST be the context string <code>"https://w3id.org/zcap/v1"</code></li>
<li><code>id</code>: MUST be a URN of the following format: <code>urn:zcap:root:${encodeURIComponent(did)}</code></li>
<li><code>invocationTarget</code>: MUST be the <code>did</code>.</li>
<li><code>controller</code>: MUST be the <code>did</code>.</li>
</ul>
<div class="tabs" id="root-capability-example">
  <div class="tablist" role="tablist" aria-label="root-capability-example">
    <button role="tab"
            id="root-capability-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="root-capability-example-panel-hide"
            data-tab="root-capability-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="root-capability-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="root-capability-example-panel-show"
            data-tab="root-capability-example-panel-show">
Show Example
    </button>
  </div>
  <section id="root-capability-example-panel-hide"
           role="tabpanel"
           aria-labelledby="root-capability-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="root-capability-example-panel-show"
           role="tabpanel"
           aria-labelledby="root-capability-example-tab-show"
           hidden>
    <label>Show Example</label>
<pre><code class="language-json">{
  "@context": "https://w3id.org/zcap/v1",
  "id": "urn:zcap:root:did%3Abtcr2%3Ax1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54",
  "invocationTarget": "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54",
  "controller": "did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54"
}
</code></pre>
  </section>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="operations"><a class="header" href="#operations">Operations</a></h1>
<p>Creating and using <strong>did:bctr2</strong> DIDs is achieved through specified
cryptographic and network operations, with all updates anchored to
Bitcoin transactions. This section defines the Create, Resolve, Update,
and Deactivate operations for the <strong>did:btcr2</strong> method.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create"><a class="header" href="#create">Create</a></h1>
<p>Creating a <strong>did:btcr2</strong> identifier from an secp256k1 public key will result
in an <a href="operations/../terminology.html#initial-did-document">Initial DID Document</a> when first resolved. Creating a <strong>did:btcr2</strong>
identifier from a <a href="operations/../terminology.html#genesis-document">Genesis Document</a> allows for the creation of a more
complex <a href="operations/../terminology.html#initial-did-document">Initial DID Document</a>, including the ability to include service
endpoints and <a href="operations/../terminology.html#btcr2-beacon">BTCR2 Beacons</a> that support aggregation. Any
active <strong>did:btcr2</strong> DID document can be updated later with new key material
and service endpoints.</p>
<h2 id="process"><a class="header" href="#process">Process</a></h2>
<p>A <strong>did:btcr2</strong> identifier encodes a few pieces of information: an indicator
for a specific Bitcoin network and a collection of <a href="operations/../terminology.html#genesis-bytes">Genesis Bytes</a>. A
specification version number is also included. These three values are
encoded with the <a href="operations/../algorithms.html#did-btcr2-identifier-encoding">DID-BTCR2 Identifier Encoding</a> algorithm.</p>
<p>The <a href="operations/../terminology.html#genesis-bytes">Genesis Bytes</a> can be created in two ways: from an secp256k1 public key
or from a <a href="operations/../terminology.html#genesis-document">Genesis Document</a>.</p>
<h2 id="secp256k1-public-key"><a class="header" href="#secp256k1-public-key">secp256k1 Public Key</a></h2>
<p>An secp256k1 public key can be used as the <a href="operations/../terminology.html#genesis-bytes">Genesis Bytes</a>. The key MUST be
in its compressed SEC format: a 33-byte representation consisting of a
single prefix byte (<code>0x02</code> or <code>0x03</code>) followed by the 32-byte x-coordinate of
the elliptic curve point. Reference Section 2.3.3 in SEC 1: Elliptic Curve Cryptography [<a href="operations/../bibliography.html#SEC">SEC</a>].</p>
<h2 id="genesis-document-hash"><a class="header" href="#genesis-document-hash">Genesis Document Hash</a></h2>
<p>A <a href="operations/../terminology.html#genesis-document">Genesis Document</a> can be used as the <a href="operations/../terminology.html#genesis-bytes">Genesis Bytes</a>, but MUST be hashed
to 32 bytes with the <a href="operations/../algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="resolve"><a class="header" href="#resolve">Resolve</a></h1>
<p>Resolving a <strong>did:btcr2</strong> identifier iteratively builds a DID document by applying <a href="operations/../terminology.html#btcr2-update">BTCR2 Updates</a> to an <a href="operations/../terminology.html#initial-did-document">Initial DID Document</a> that have been committed to the Bitcoin blockchain by <a href="operations/../terminology.html#authorized-beacon-signal">Authorized Beacon Signals</a>. The <a href="operations/../terminology.html#initial-did-document">Initial DID Document</a> is either deterministically created from the DID or provided by <a href="operations/../terminology.html#sidecar-data">Sidecar Data</a>.</p>
<p>DID resolution is defined by DID Resolution v0.3 [<a href="operations/../bibliography.html#DID-RESOLUTION">DID-RESOLUTION</a>].</p>
<p>The resolve operation has the following function signature:</p>
<pre><code class="language-rust">fn resolve(did, resolutionOptions) -&gt;
  (didResolutionMetadata, didDocument, didDocumentMetadata)</code></pre>
<h2 id="process-1"><a class="header" href="#process-1">Process</a></h2>
<p>Input values MUST first go through <a href="operations/resolve.html#decode-the-did">Decoding the DID</a> and <a href="operations/resolve.html#process-sidecar-data">Processing Sidecar Data</a>.</p>
<p>Resolution maintains the following state while building the DID document:</p>
<ul>
<li><code>updates</code>: a list of tuples, each containing Bitcoin block metadata (height, time, confirmations) and a <a href="operations/../data-structures.html#btcr2-signed-update">BTCR2 Signed Update (data structure)</a>.</li>
<li><code>current_document</code>: the DID document being assembled.</li>
<li><code>current_version_id</code>: the version number being processed (starts at <code>1</code>).</li>
<li><code>update_hash_history</code>: a list of <a href="operations/../terminology.html#btcr2-unsigned-update">BTCR2 Unsigned Update</a> hashes used to detect duplicates.</li>
<li><code>block_confirmations</code>: confirmations for the Bitcoin block that contains the most recently applied unique update.</li>
</ul>
<p>The resolver:</p>
<ol>
<li><a href="operations/resolve.html#establish-current-document">Establishes <code>current_document</code></a> from the DID or from <a href="operations/../terminology.html#sidecar-data">Sidecar Data</a>.</li>
<li>Repeats the following loop:
<ul>
<li><a href="operations/resolve.html#process-beacon-signals">Process Beacon Signals</a> to populate <code>updates</code> from the beacon services in <code>current_document</code>.</li>
<li><a href="operations/resolve.html#process-updates">Process <code>updates</code> Array</a> to apply updates to <code>current_document</code> and refresh <code>block_confirmations</code>.</li>
<li>Stops when processing updates returns early with a resolved <code>didDocument</code> or an error occurs.</li>
</ul>
</li>
</ol>
<p>The resolver returns:</p>
<ul>
<li><code>didResolutionMetadata</code>: a <a href="operations/../data-structures.html#did-resolution-metadata">DID Resolution Metadata (data structure)</a> (MAY be empty).</li>
<li><code>didDocument</code>: the final <a href="operations/../data-structures.html#did-document">DID document (data structure)</a>.</li>
<li><code>didDocumentMetadata</code>: a <a href="operations/../data-structures.html#did-document-metadata">DID document metadata (data structure)</a> with REQUIRED fields:
<ul>
<li><code>versionId</code>: <code>current_version_id</code> as an ASCII string.</li>
<li><code>confirmations</code>: <code>block_confirmations</code> as an integer. <sup class="footnote-reference" id="fr-1-1"><a href="#footnote-1">1</a></sup></li>
<li><code>deactivated</code>: <code>current_document.deactivated</code>.</li>
</ul>
</li>
</ul>
<h2 id="decode-the-did"><a class="header" href="#decode-the-did">Decode the DID</a></h2>
<p>The <code>did</code> MUST be parsed with the <a href="operations/../algorithms.html#did-btcr2-identifier-decoding">DID-BTCR2 Identifier Decoding</a> algorithm to retrieve <code>version</code>,
<code>network</code>, and <code>genesis_bytes</code>. An <a href="operations/../errors.html"><code>INVALID_DID</code></a> error MUST be raised in response to any errors
raised while decoding.</p>
<h2 id="process-sidecar-data"><a class="header" href="#process-sidecar-data">Process Sidecar Data</a></h2>
<p><code>resolutionOptions</code> contains a <code>sidecar</code> property (<a href="operations/../data-structures.html#sidecar-data">Sidecar Data (data structure)</a>) which SHOULD be prepared as lookup tables:</p>
<ul>
<li>Hash each <a href="operations/../data-structures.html#btcr2-signed-update">BTCR2 Signed Update (data structure)</a> in <code>sidecar.updates</code> with the <a href="operations/../algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm and build a map from hash to update (<code>update_lookup_table</code>).</li>
<li>Hash each <a href="operations/../data-structures.html#cas-announcement">CAS Announcement (data structure)</a> in <code>sidecar.casUpdates</code> with the <a href="operations/../algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm and build a map from hash to announcement (<code>cas_lookup_table</code>).</li>
<li>Build a map from <code>sidecar.smtProofs</code> keyed by proof <code>id</code> (<code>smt_lookup_table</code>).</li>
</ul>
<p>If <code>genesis_bytes</code> is a SHA-256 hash, hash <code>sidecar.genesisDocument</code> with the <a href="operations/../algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm. Raise an <a href="operations/../errors.html"><code>INVALID_DID</code></a> error if the computed hash does not match <code>genesis_bytes</code>.</p>
<h2 id="establish-current-document"><a class="header" href="#establish-current-document">Establish <code>current_document</code></a></h2>
<p>Resolution begins by creating an <a href="operations/../terminology.html#initial-did-document">Initial Did Document</a> called <code>current_document</code> (<a href="operations/../terminology.html#current-did-document">Current DID Document</a>). The <code>current_document</code> is iteratively patched with <a href="operations/../terminology.html#btcr2-signed-update">BTCR2 Signed Updates</a> announced by <a href="operations/../terminology.html#authorized-beacon-signal">Authorized Beacon Signals</a>.</p>
<p>Choose how to establish <code>current_document</code> based on the type of <code>genesis_bytes</code> retrieved from the decoded <code>did</code>:</p>
<h3 id="if-genesis_bytes-is-a-sha-256-hash"><a class="header" href="#if-genesis_bytes-is-a-sha-256-hash">If <code>genesis_bytes</code> is a SHA-256 Hash</a></h3>
<p>Process the <a href="operations/../terminology.html#genesis-document">Genesis Document</a> provided in <code>sidecar.genesisDocument</code> by replacing the identifier placeholder (<code>"did:btcr2:_"</code>) with the <code>did</code>. A simple string replacement is sufficient. Parse the result as JSON to form <code>current_document</code>. The resulting <a href="operations/../data-structures.html#did-document">DID Document (data structure)</a> MUST be conformant to DID Core v1.1 [<a href="operations/../bibliography.html#DID-CORE">DID-CORE</a>].</p>
<h3 id="if-genesis_bytes-is-a-secp256k1-public-key"><a class="header" href="#if-genesis_bytes-is-a-secp256k1-public-key">If <code>genesis_bytes</code> is a secp256k1 Public Key</a></h3>
<p>Render the <a href="operations/../terminology.html#initial-did-document">Initial DID Document</a> template with these values (Bitcoin addresses MUST use the Bitcoin URI Scheme [<a href="operations/../bibliography.html#BIP321">BIP321</a>]):</p>
<ul>
<li><code>did</code>: The <code>did</code>.</li>
<li><code>public-key-multikey</code>: Public key as a Multibase <code>"base-58-btc"</code> [<a href="operations/../bibliography.html#CID">CID</a>] encoded string.</li>
<li><code>p2pkh-bitcoin-address</code>: Pay-to-Public-Key-Hash (P2PKH) Bitcoin address produced from the public key.</li>
<li><code>p2wpkh-bitcoin-address</code>: Pay-to-Witness-Public-Key-Hash (P2WPKH) Bitcoin address produced from the public key.</li>
<li><code>p2tr-bitcoin-address</code>: Pay-to-Taproot Bitcoin address produced from the public key.</li>
</ul>
<div class="tabs" id="initial-did-document-template">
  <div class="tablist" role="tablist" aria-label="initial-did-document-template">
    <button role="tab"
            id="initial-did-document-template-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="initial-did-document-template-panel-hide"
            data-tab="initial-did-document-template-panel-hide">
Hide
    </button>
    <button role="tab"
            id="initial-did-document-template-tab-show"
            aria-selected="false"
            class=""
            aria-controls="initial-did-document-template-panel-show"
            data-tab="initial-did-document-template-panel-show">
Show Template
    </button>
  </div>
  <section id="initial-did-document-template-panel-hide"
           role="tabpanel"
           aria-labelledby="initial-did-document-template-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="initial-did-document-template-panel-show"
           role="tabpanel"
           aria-labelledby="initial-did-document-template-tab-show"
           hidden>
    <label>Show Template</label>
<pre><code class="language-hbs">{
  "@context": [
    "https://www.w3.org/TR/did-1.1",
    "https://btcr2.dev/context/v1"
  ],
  "id": "{{did}}",
  "controller": [
    "{{did}}"
  ],
  "verificationMethod": [
    {
      "id": "{{did}}#initialKey",
      "type": "Multikey",
      "controller": "{{did}}",
      "publicKeyMultibase": "{{public-key-multikey}}"
    }
  ],
  "authentication": [
    "{{did}}#initialKey"
  ],
  "assertionMethod": [
    "{{did}}#initialKey"
  ],
  "capabilityInvocation": [
    "{{did}}#initialKey"
  ],
  "capabilityDelegation": [
    "{{did}}#initialKey"
  ],
  "service": [
    {
      "id": "{{did}}#initialP2PKH",
      "type": "SingletonBeacon",
      "serviceEndpoint": "{{p2pkh-bitcoin-address}}"
    },
    {
      "id": "{{did}}#initialP2WPKH",
      "type": "SingletonBeacon",
      "serviceEndpoint": "{{p2wpkh-bitcoin-address}}"
    },
    {
      "id": "{{did}}#initialP2TR",
      "type": "SingletonBeacon",
      "serviceEndpoint": "{{p2tr-bitcoin-address}}"
    }
  ]
}
</code></pre>
  </section>
</div>
<p>Parse the rendered template as JSON to form <code>current_document</code>. The resulting <a href="operations/../data-structures.html#did-document">DID Document (data structure)</a> MUST be conformant to DID Core v1.1 [<a href="operations/../bibliography.html#DID-CORE">DID-CORE</a>].</p>
<h2 id="process-beacon-signals"><a class="header" href="#process-beacon-signals">Process Beacon Signals</a></h2>
<p>Scan the <code>service</code> entries in <code>current_document</code> (<a href="operations/../data-structures.html#did-document">DID Document (data structure)</a>) and identify <a href="operations/../terminology.html#btcr2-beacon">BTCR2 Beacons</a> by matching service <code>type</code> to <a href="operations/../beacons.html#beacon-types">Beacons Table 1: Beacon Types</a>. Parse each beacon <code>serviceEndpoint</code> as a <a href="operations/../terminology.html#beacon-address">Beacon Address</a>, then use those <a href="operations/../terminology.html#beacon-address">Beacon Addresses</a> to find Bitcoin transactions whose last output script contains <a href="operations/../terminology.html#signal-bytes">Signal Bytes</a>.</p>
<p>Implementations are RECOMMENDED to query an indexed Bitcoin blockchain RPC service such as <a href="https://github.com/romanz/electrs">electrs</a> or <a href="https://github.com/Blockstream/esplora">Esplora</a>. Implementations MAY instead traverse blocks from the genesis block. Cache <a href="operations/../terminology.html#beacon-address">Beacon Addresses</a> to avoid repeated transaction lookups.</p>
<p>For each transaction found:</p>
<ul>
<li>Derive <code>update_hash</code> from the transaction’s <a href="operations/../terminology.html#signal-bytes">Signal Bytes</a> based on the beacon type:
<ul>
<li>Singleton Beacon: <code>update_hash</code> is the <a href="operations/../terminology.html#signal-bytes">Signal Bytes</a>.</li>
<li>CAS Beacon: use <a href="operations/resolve.html#process-cas-beacon">Process CAS Beacon</a>.</li>
<li>SMT Beacon: use <a href="operations/resolve.html#process-smt-beacon">Process SMT Beacon</a>.</li>
</ul>
</li>
<li>Build a tuple with:
<ul>
<li>The transaction’s block metadata (height, time, and confirmations).</li>
<li>The <a href="operations/../data-structures.html#btcr2-signed-update">BTCR2 Signed Update (data structure)</a> retrieved from <code>update_lookup_table[update_hash]</code>.
<ul>
<li>If the update is not in <code>update_lookup_table</code>, raise a <a href="operations/../errors.html#missing_update_data"><code>MISSING_UPDATE_DATA</code></a> error.</li>
</ul>
</li>
</ul>
</li>
<li>Append the tuple to <code>updates</code>.</li>
</ul>
<h3 id="process-cas-beacon"><a class="header" href="#process-cas-beacon">Process CAS Beacon</a></h3>
<p>Treat <a href="operations/../terminology.html#signal-bytes">Signal Bytes</a> as <code>map_update_hash</code>. Look up <code>map_update_hash</code> in <code>cas_lookup_table</code> to retrieve a <a href="operations/../data-structures.html#cas-announcement">CAS Announcement (data structure)</a> and read <code>update_hash</code> from the announcement entry keyed by <code>did</code>.</p>
<h3 id="process-smt-beacon"><a class="header" href="#process-smt-beacon">Process SMT Beacon</a></h3>
<p>Treat <a href="operations/../terminology.html#signal-bytes">Signal Bytes</a> as <code>smt_root</code>. Look up <code>smt_root</code> in <code>smt_lookup_table</code> to retrieve an <a href="operations/../data-structures.html#smt-proof">SMT Proof (data structure)</a>. Validate the proof with the <a href="operations/../algorithms.html#smt-proof-verification">SMT Proof Verification</a> algorithm. Use <code>smt_proof.updateId</code> as <code>update_hash</code>.</p>
<h2 id="process-updates"><a class="header" href="#process-updates">Process <code>updates</code> Array</a></h2>
<p>Return <code>current_document</code> as the resolved <code>didDocument</code> if <code>updates</code> is empty.</p>
<p>Otherwise:</p>
<ol>
<li>Sort <code>updates</code> by <a href="operations/../data-structures.html#btcr2-signed-update">BTCR2 Signed Update (data structure)</a> <code>targetVersionId</code> (ascending) with the tuple’s block height as a tiebreaker. Take the first tuple.</li>
<li>Set <code>block_confirmations</code> to the tuple’s block confirmations.</li>
<li>If <code>resolutionOptions.versionTime</code> is provided and the tuple’s block time is more recent, return <code>current_document</code> as the resolved <code>didDocument</code>.</li>
<li>Set <code>update</code> to the tuple’s <a href="operations/../data-structures.html#btcr2-signed-update">BTCR2 Signed Update (data structure)</a> and <a href="operations/resolve.html#check-update-version">check <code>update.targetVersionId</code></a>.</li>
<li>Increment <code>current_version_id</code>.</li>
<li>If <code>current_version_id</code> is greater than or equal to the integer form of <code>resolutionOptions.versionId</code>, return <code>current_document</code>.</li>
<li>If <code>current_document.deactivated</code> is <code>true</code>, return <code>current_document</code>.</li>
</ol>
<h3 id="check-update-version"><a class="header" href="#check-update-version">Check <code>update.targetVersionId</code></a></h3>
<p>Compare <code>update.targetVersionId</code> to <code>current_version_id</code>. Only one of three possible conditions will occur:</p>
<ul>
<li><code>update.targetVersionId &lt;= current_version_id</code>:
<ul>
<li><a href="operations/resolve.html#confirm-duplicate-update">Confirm Duplicate Update</a>.</li>
</ul>
</li>
<li><code>update.targetVersionId == current_version_id + 1</code>:
<ul>
<li><a href="operations/resolve.html#apply-update">Apply <code>update</code></a>.</li>
</ul>
</li>
<li><code>update.targetVersionId &gt; current_version_id + 1</code>:
<ul>
<li><a href="operations/../errors.html#late_publishing"><code>LATE_PUBLISHING</code></a> error MUST be raised.</li>
</ul>
</li>
</ul>
<h3 id="confirm-duplicate-update"><a class="header" href="#confirm-duplicate-update">Confirm Duplicate Update</a></h3>
<p>This step confirms that an update with a lower-than-expected <code>targetVersionId</code> is a true duplicate.</p>
<p>Create <code>unsigned_update</code> by removing the <code>proof</code> property from <code>update</code>. Hash <code>unsigned_update</code> with the <a href="operations/../algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm and compare it to <code>update_hash_history[update.targetVersionId - 2]</code>. Raise a <a href="operations/../errors.html#late_publishing"><code>LATE_PUBLISHING</code></a> error if the hashes differ.</p>
<h3 id="apply-update"><a class="header" href="#apply-update">Apply <code>update</code></a></h3>
<p>Hash <code>current_document</code> with the <a href="operations/../algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm. Raise an <a href="operations/../errors.html#invalid_did_update"><code>INVALID_DID_UPDATE</code></a> error if the result does not match the decoded <code>update.sourceHash</code>.</p>
<p><a href="operations/resolve.html#check-update-proof">Check <code>update.proof</code></a>.</p>
<p>Apply the <code>update.patch</code> JSON Patch [<a href="operations/../bibliography.html#RFC6902">RFC6902</a>] to <code>current_document</code>.</p>
<p>Verify that <code>current_document</code> conforms to DID Core v1.1 [<a href="operations/../bibliography.html#DID-CORE">DID-CORE</a>] and that <code>current_document.id</code> equals <code>did</code>. Otherwise raise <a href="operations/../errors.html#invalid_did_update"><code>INVALID_DID_UPDATE</code></a>.</p>
<p>Hash the patched <code>current_document</code> with the <a href="operations/../algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm. Raise an <a href="operations/../errors.html#invalid_did_update"><code>INVALID_DID_UPDATE</code></a> error if the result does not match the decoded <code>update.targetHash</code>.</p>
<p>Create <code>unsigned_update</code> by removing the <code>proof</code> property from <code>update</code>, hash it with the <a href="operations/../algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm, and append the hash to <code>update_hash_history</code>.</p>
<h3 id="check-update-proof"><a class="header" href="#check-update-proof">Check <code>update.proof</code></a></h3>
<p>Implementations MAY derive a <a href="operations/../data-structures.html#root-capability">Root Capability (data structure)</a> from <code>update.proof</code> and invoke it according to Authorization Capabilities for Linked Data v0.3 [<a href="operations/../bibliography.html#ZCAP-LD">ZCAP-LD</a>].</p>
<p>The resolver must locate <code>publicKeyMultibase</code> in <code>current_document.verificationMethod</code> whose <code>id</code> matches <code>update.proof.verificationMethod</code>. Otherwise raise <a href="operations/../errors.html#invalid_did_update"><code>INVALID_DID_UPDATE</code></a>. Raise the same error if <code>current_document.capabilityInvocation</code> does not contain <code>update.proof.verificationMethod</code>.</p>
<p>Use a BIP340 Cryptosuite [<a href="operations/../bibliography.html#BIP340-Cryptosuite">BIP340-Cryptosuite</a>] instance with <code>publicKeyMultibase</code> and the <code>"bip340-jcs-2025"</code> cryptosuite to verify <code>update</code>. Raise <a href="operations/../errors.html#invalid_did_update"><code>INVALID_DID_UPDATE</code></a> if verification fails.</p>
<!-- Line breaks to visibly separate the preceding subsection from the chapter footnotes. -->
<br>
<br>
<hr>
<ol class="footnote-definition"><li id="footnote-1">
<p>The number of confirmations for the Bitcoin block that contains the most recently applied unique update that yielded the resolved DID document. “Unique” refers to handling duplicated updates. When deduplicating, use the lowest block height to determine confirmations. <a href="#fr-1-1">↩</a></p>
</li>
</ol><div style="break-before: page; page-break-before: always;"></div><h1 id="update"><a class="header" href="#update">Update</a></h1>
<p><strong>did:btcr2</strong> DID documents can be updated by anchoring <a href="operations/../terminology.html#btcr2-update">BTCR2 Updates</a> to Bitcoin transactions. These transactions MAY be published to the Bitcoin network.</p>
<p>Any property in the DID document may be updated except the <code>id</code>. Doing so would invalidate the DID document.</p>
<p>The update operation has the following function signature:</p>
<pre><code class="language-rust">fn update(
  didSourceDocument,
  jsonPatches,
  targetVersionId,
  verificationMethodId,
  privateKey,
) -&gt;
  signedUpdate</code></pre>
<p>Input arguments:</p>
<ul>
<li><code>didSourceDocument</code>: The source DID document.</li>
<li><code>jsonPatches</code>: An array of JSON patch documents [<a href="operations/../bibliography.html#RFC6902">RFC6902</a>] with the changes to be made to the source DID document.</li>
<li><code>targetVersionId</code>: The <code>versionId</code> of the target DID document that the new <a href="operations/../terminology.html#btcr2-signed-update">BTCR2 Signed Update</a> will yield.</li>
<li><code>verificationMethodId</code>: The <code>verificationMethod</code> ID used for signing the <a href="operations/../terminology.html#btcr2-update">BTCR2 Update</a>.</li>
<li><code>privateKey</code>: Private key associated with the <code>verificationMethodId</code>.
<ul>
<li>An implementation MAY use the <code>verificationMethodId</code> ID to retrieve the private key from a key material manager.</li>
</ul>
</li>
</ul>
<p>Outputs:</p>
<ul>
<li><code>signedUpdate</code>: A copy of the <a href="operations/../terminology.html#btcr2-signed-update">BTCR2 Signed Update</a> anchored to the Bitcoin blockchain by a <a href="operations/../terminology.html#btcr2-update-announcement">BTCR2 Update Announcement</a>.</li>
</ul>
<h2 id="process-2"><a class="header" href="#process-2">Process</a></h2>
<p>Updating a <strong>did:btcr2</strong> DID document is a matter of constructing a <a href="operations/../terminology.html#btcr2-signed-update">BTCR2 Signed Update</a> then announcing that update via one or more <a href="operations/../terminology.html#btcr2-beacon">BTCR2 Beacons</a> listed in the DID document. The update announcement process varies depending on the <a href="operations/../terminology.html#beacon-type">Beacon Type</a>.</p>
<p>Constructing a <a href="operations/../terminology.html#btcr2-signed-update">BTCR2 Signed Update</a> is a two-step process. First, a <a href="operations/../terminology.html#btcr2-unsigned-update">BTCR2 Unsigned Update</a> is constructed. Then the update is signed with a private key to construct the <a href="operations/../terminology.html#btcr2-signed-update">BTCR2 Signed Update</a>.</p>
<h2 id="construct-btcr2-unsigned-update"><a class="header" href="#construct-btcr2-unsigned-update">Construct BTCR2 Unsigned Update</a></h2>
<p>This process constructs a <a href="operations/../data-structures.html#btcr2-unsigned-update">BTCR2 Unsigned Update (data structure)</a>.</p>
<p>Apply all JSON patches in <code>jsonPatches</code> to <code>didSourceDocument</code> to create <code>didTargetDocument</code>. <code>didTargetDocument</code> MUST be conformant to DID Core v1.1 [<a href="operations/../bibliography.html#DID-CORE">DID-CORE</a>]. An <a href="operations/../errors.html#invalid_did_update"><code>INVALID_DID_UPDATE</code></a> error MUST be raised if <code>didTargetDocument.id</code> is not equal to <code>didSourceDocument.id</code>.</p>
<p>Fill the <a href="operations/../data-structures.html#btcr2-unsigned-update">BTCR2 Unsigned Update (data structure)</a> template below with the required template variables.</p>
<ul>
<li><code>array-of-patches</code>: <code>jsonPatches</code> serialized to a JSON string.</li>
<li><code>source-hash</code>: <code>didSourceDocument</code> hashed with the <a href="operations/../algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm.</li>
<li><code>target-hash</code>: <code>didTargetDocument</code> hashed with the <a href="operations/../algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm.</li>
<li><code>target-version-id</code>: The value of <code>targetVersionId</code>.</li>
</ul>
<div class="tabs" id="btcr2-unsigned-update-template">
  <div class="tablist" role="tablist" aria-label="btcr2-unsigned-update-template">
    <button role="tab"
            id="btcr2-unsigned-update-template-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="btcr2-unsigned-update-template-panel-hide"
            data-tab="btcr2-unsigned-update-template-panel-hide">
Hide
    </button>
    <button role="tab"
            id="btcr2-unsigned-update-template-tab-show"
            aria-selected="false"
            class=""
            aria-controls="btcr2-unsigned-update-template-panel-show"
            data-tab="btcr2-unsigned-update-template-panel-show">
Show Template
    </button>
  </div>
  <section id="btcr2-unsigned-update-template-panel-hide"
           role="tabpanel"
           aria-labelledby="btcr2-unsigned-update-template-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="btcr2-unsigned-update-template-panel-show"
           role="tabpanel"
           aria-labelledby="btcr2-unsigned-update-template-tab-show"
           hidden>
    <label>Show Template</label>
<pre><code class="language-hbs">{
  "@context": [
    "https://w3id.org/security/v2",
    "https://w3id.org/zcap/v1",
    "https://w3id.org/json-ld-patch/v1",
    "https://btcr2.dev/context/v1"
  ],
  "patch": {{array-of-patches}},
  "sourceHash": "{{source-hash}}",
  "targetHash": "{{target-hash}}",
  "targetVersionId": {{target-version-id}}
}
</code></pre>
  </section>
</div>
<p>Let <code>update</code> be the result of parsing the rendered template as JSON. The
resulting <a href="operations/../data-structures.html#btcr2-unsigned-update">BTCR2 Unsigned Update (data structure)</a> MUST be conformant to this specification.</p>
<h2 id="construct-btcr2-signed-update"><a class="header" href="#construct-btcr2-signed-update">Construct BTCR2 Signed Update</a></h2>
<p>This process constructs a <a href="operations/../data-structures.html#btcr2-signed-update">BTCR2 Signed Update (data structure)</a> from <code>update</code>, a <a href="operations/../data-structures.html#btcr2-unsigned-update">BTCR2 Unsigned Update (data structure)</a>.</p>
<p>An <a href="operations/../errors.html#invalid_did_update"><code>INVALID_DID_UPDATE</code></a> error MUST be raised if the <code>didSourceDocument.verificationMethod</code> Set does not contain an <code>id</code> matching <code>verificationMethodId</code>.</p>
<p>An <a href="operations/../errors.html#invalid_did_update"><code>INVALID_DID_UPDATE</code></a> error MUST be raised if the <code>didSourceDocument.capabilityInvocation</code> Set does not contain <code>verificationMethodId</code>.</p>
<p>Create <code>cryptosuite</code> as a BIP340 Cryptosuite [<a href="operations/../bibliography.html#BIP340-Cryptosuite">BIP340-Cryptosuite</a>] instance with <code>privateKey</code> and <code>"bip340-jcs-2025"</code> cryptosuite.</p>
<p>Fill the Data Integrity [<a href="operations/../bibliography.html#VC-DATA-INTEGRITY">VC-DATA-INTEGRITY</a>] template below with the required template variables.</p>
<ul>
<li><code>verification-method</code>: The value of <code>verificationMethodId</code>.</li>
<li><code>capability</code>: A URN of the following format: <code>urn:zcap:root:${encodeURIComponent(didSourceDocument.id)}</code>.</li>
</ul>
<div class="tabs" id="data-integrity-config-template">
  <div class="tablist" role="tablist" aria-label="data-integrity-config-template">
    <button role="tab"
            id="data-integrity-config-template-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="data-integrity-config-template-panel-hide"
            data-tab="data-integrity-config-template-panel-hide">
Hide
    </button>
    <button role="tab"
            id="data-integrity-config-template-tab-show"
            aria-selected="false"
            class=""
            aria-controls="data-integrity-config-template-panel-show"
            data-tab="data-integrity-config-template-panel-show">
Show Template
    </button>
  </div>
  <section id="data-integrity-config-template-panel-hide"
           role="tabpanel"
           aria-labelledby="data-integrity-config-template-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="data-integrity-config-template-panel-show"
           role="tabpanel"
           aria-labelledby="data-integrity-config-template-tab-show"
           hidden>
    <label>Show Template</label>
<pre><code class="language-hbs">{
  "@context": [
    "https://w3id.org/security/v2",
    "https://w3id.org/zcap/v1",
    "https://w3id.org/json-ld-patch/v1",
    "https://btcr2.dev/context/v1"
  ],
  "type": "DataIntegrityProof",
  "cryptosuite": "bip340-jcs-2025",
  "verificationMethod": "{{ verification-method }}",
  "proofPurpose": "capabilityInvocation",
  "capability": "{{ capability }}",
  "capabilityAction": "Write"
}
</code></pre>
  </section>
</div>
<p>Let <code>proofConfig</code> be the result of parsing the rendered template as JSON. The
resulting <a href="operations/../data-structures.html#data-integrity-config">Data Integrity Config (data structure)</a> MUST be conformant to Verifiable Credentials Data Integrity 1.0 [<a href="operations/../bibliography.html#VC-DATA-INTEGRITY">VC-DATA-INTEGRITY</a>].</p>
<p>Pass <code>update</code> and <code>proofConfig</code> to the <code>cryptosuite.createProof</code> method and set <code>update.proof</code> to the resulting <a href="operations/../data-structures.html#data-integrity-proof">Data Integrity Proof (data structure)</a>.</p>
<h2 id="announce-did-update"><a class="header" href="#announce-did-update">Announce DID Update</a></h2>
<p><a href="operations/../terminology.html#btcr2-signed-update">BTCR2 Signed Updates</a> are announced to the Bitcoin blockchain depending on the <a href="operations/../terminology.html#beacon-type">Beacon Type</a>.</p>
<h3 id="announcing-to-a-singleton-beacon"><a class="header" href="#announcing-to-a-singleton-beacon">Announcing to a Singleton Beacon</a></h3>
<p>A <a href="operations/../terminology.html#btcr2-update-announcement">BTCR2 Update Announcement</a> for a <a href="operations/../terminology.html#singleton-beacon">Singleton Beacon</a> is the <a href="operations/../terminology.html#btcr2-signed-update">BTCR2 Signed Update</a> hashed with the <a href="operations/../algorithms.html#json-document-hashing">JSON Document Hashing</a> algorithm. This 32-byte SHA-256 hash is used as the <a href="operations/../terminology.html#signal-bytes">Signal Bytes</a> when constructing a <a href="operations/../terminology.html#beacon-signal">Beacon Signal</a> Bitcoin transaction. The <a href="operations/../terminology.html#beacon-signal">Beacon Signal</a> is signed by the private key that controls the <a href="operations/../terminology.html#beacon-address">Beacon Address</a> and broadcast to the Bitcoin network. To broadcast signed Bitcoin transactions, see the [<a href="operations/../bibliography.html#Bitcoin-Core">Bitcoin-Core</a>] source code.</p>
<h3 id="announcing-to-an-aggregate-beacon"><a class="header" href="#announcing-to-an-aggregate-beacon">Announcing to an Aggregate Beacon</a></h3>
<p>Aggregating and announcing updates for multiple <strong>did:btcr2</strong> identifiers is the responsibility of the <a href="operations/../terminology.html#aggregation-service">Aggregation Service</a>.
The main responsibilities include establishing a protocol for one or more rounds of secure group communications amongst <a href="operations/../terminology.html#aggregation-participant">Aggregation Participants</a>, advertising available <a href="operations/../terminology.html#aggregation-cohort">Aggregation Cohorts</a> to <a href="operations/../terminology.html#aggregation-participant">Aggregation Participants</a> including the creation, management, timing and scheduling of those <a href="operations/../terminology.html#aggregation-cohort">Aggregation Cohorts</a>, and broadcasting a Bitcoin transaction to the Bitcoin network that includes signatures from all <a href="operations/../terminology.html#aggregation-participant">Aggregation Participants</a> in a given <a href="operations/../terminology.html#aggregation-cohort">Aggregation Cohort</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deactivate"><a class="header" href="#deactivate">Deactivate</a></h1>
<p>To deactivate a <strong>did:btcr2</strong>, the DID controller MUST add the property <code>deactivated</code> with the value <code>true</code> to the DID document. To do this, the DID controller constructs a valid <a href="operations/../terminology.html#btcr2-update">BTCR2 Update</a> with a JSON Patch [<a href="operations/../bibliography.html#RFC6902">RFC6902</a>] that adds this property and announces the <a href="operations/../terminology.html#btcr2-update">BTCR2 Update</a> by broadcasting an <a href="operations/../terminology.html#authorized-beacon-signal">Authorized Beacon Signal</a> following the algorithms defined in <a href="operations/update.html">Update</a>. Once a <strong>did:btcr2</strong> has been deactivated this state is considered permanent and resolution MUST terminate.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="algorithms"><a class="header" href="#algorithms">Algorithms</a></h1>
<p>These algorithms are referenced throughout this specification.</p>
<h2 id="did-btcr2-identifier-encoding"><a class="header" href="#did-btcr2-identifier-encoding">DID-BTCR2 Identifier Encoding</a></h2>
<p>Any errors encountered during this algorithm MUST raise an <a href="./errors.html"><code>INVALID_DID</code></a> error.</p>
<p>A <strong>did:btcr2</strong> identifier is created from three arguments: <code>version_number</code>, <code>network_name</code> and <code>key_or_hash</code> (<a href="./terminology.html#genesis-bytes">Genesis Bytes</a>).</p>
<p><code>key_or_hash</code> MUST be one of the supported <a href="./terminology.html#genesis-bytes">Genesis Bytes</a> variants defined in the Terminology chapter and MUST be representable as a 33-byte secp256k1 public key or a 32-byte SHA-256 hash. Implementations SHOULD require <code>key_or_hash</code> to include additional type information that clearly distinguishes between the supported <a href="./terminology.html#genesis-bytes">Genesis Bytes</a> variants. This type information determines how the identifier is encoded.</p>
<p>The <code>version_number</code> value MUST be <code>1</code>, declaring the encoding follows this specification.</p>
<p>The <code>network_name</code> value declares which Bitcoin network anchors the identifier. Implementations SHOULD require <code>network_name</code> to include additional type information using symbolic names that MUST be representable as integer values listed in the following table:</p>
<h3 id="network-values"><a class="header" href="#network-values">Table 1: Network Values</a></h3>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left"><code>network_name</code></th><th style="text-align: left"><code>network_value</code></th></tr></thead><tbody>
<tr><td style="text-align: left"><code>bitcoin</code></td><td style="text-align: left"><code>0</code></td></tr>
<tr><td style="text-align: left"><code>signet</code></td><td style="text-align: left"><code>1</code></td></tr>
<tr><td style="text-align: left"><code>regtest</code></td><td style="text-align: left"><code>2</code></td></tr>
<tr><td style="text-align: left"><code>testnet3</code></td><td style="text-align: left"><code>3</code></td></tr>
<tr><td style="text-align: left"><code>testnet4</code></td><td style="text-align: left"><code>4</code></td></tr>
<tr><td style="text-align: left"><code>mutinynet</code></td><td style="text-align: left"><code>5</code></td></tr>
<tr><td style="text-align: left">Reserved</td><td style="text-align: left"><code>6</code>..<code>11</code></td></tr>
<tr><td style="text-align: left">Custom networks</td><td style="text-align: left"><code>12</code>..<code>14</code></td></tr>
</tbody></table>
</div>
<p>Introduce <code>btcr2_version</code> as <code>version_number - 1</code> (i.e., <code>0</code>). Combine <code>btcr2_version</code> in the low <sup class="footnote-reference" id="fr-1-1"><a href="#footnote-1">1</a></sup> nibble and <code>network_value</code> in the high <sup class="footnote-reference" id="fr-1-2"><a href="#footnote-1">1</a></sup> nibble into a single byte value.</p>
<p>Append <code>key_or_hash</code> to the first byte to produce the unencoded data bytes. Its format is:</p>
<h3 id="unencoded-data-bytes"><a class="header" href="#unencoded-data-bytes">Table 2: Unencoded Data Bytes</a></h3>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left"></th><th style="text-align: left"><code>btcr2_version</code></th><th style="text-align: left"><code>network_value</code></th><th style="text-align: left"><code>genesis_bytes</code></th></tr></thead><tbody>
<tr><td style="text-align: left">Size:</td><td style="text-align: left">4 bits</td><td style="text-align: left">4 bits</td><td style="text-align: left">32 or 33 bytes</td></tr>
<tr><td style="text-align: left">Index <sup class="footnote-reference" id="fr-2-1"><a href="#footnote-2">2</a></sup>:</td><td style="text-align: left">0</td><td style="text-align: left">4</td><td style="text-align: left">8</td></tr>
</tbody></table>
</div>
<p>Encode the unencoded data bytes with Bech32m [<a href="bibliography.html#BIP350">BIP350</a>] to produce the <code>method-specific-id</code>. Use <code>"k"</code> as the <code>hrp</code> for key-based <code>key_or_hash</code> and <code>"x"</code> as the <code>hrp</code> for <a href="./terminology.html#genesis-document">Genesis Document</a>-based <code>key_or_hash</code>.</p>
<p>Prefix the <code>method-specific-id</code> with the string <code>"did:btcr2:"</code> to produce the final <strong>did:btcr2</strong> identifier.</p>
<div class="tabs" id="identifier-encoding-example">
  <div class="tablist" role="tablist" aria-label="identifier-encoding-example">
    <button role="tab"
            id="identifier-encoding-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="identifier-encoding-example-panel-hide"
            data-tab="identifier-encoding-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="identifier-encoding-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="identifier-encoding-example-panel-show"
            data-tab="identifier-encoding-example-panel-show">
Show Example
    </button>
  </div>
  <section id="identifier-encoding-example-panel-hide"
           role="tabpanel"
           aria-labelledby="identifier-encoding-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="identifier-encoding-example-panel-show"
           role="tabpanel"
           aria-labelledby="identifier-encoding-example-tab-show"
           hidden>
    <label>Show Example</label>
<p>Example input:</p>
<ul>
<li><code>version_number</code>: <code>1</code></li>
<li><code>network_name</code>: <code>bitcoin</code> (<code>network_value</code> = <code>0</code>)</li>
<li><code>key_or_hash</code>: SEC encoded secp256k1 public key
<code>171d59dd2d274011cbb090acc5a168dc98f303790ffce8f54779baed81890c1b00</code></li>
</ul>
<p>Example output:</p>
<ul>
<li><code>did</code>: <code>"did:btc1:k1qqt36kwa95n5qywtkzg2e3dpdrwf3ucr0y8le684gaum4mvp3yxpkqqx0845q"</code></section>
</li>
</ul>
</div>
<h2 id="did-btcr2-identifier-decoding"><a class="header" href="#did-btcr2-identifier-decoding">DID-BTCR2 Identifier Decoding</a></h2>
<p>Any errors encountered during this algorithm MUST raise an <a href="./errors.html"><code>INVALID_DID</code></a> error.</p>
<p>Parsing a <strong>did:btcr2</strong> identifier produces three values: <code>version_number</code>, <code>network_name</code>, and <code>key_or_hash</code> (<a href="./terminology.html#genesis-bytes">Genesis Bytes</a>).</p>
<p>A <strong>did:btcr2</strong> identifier MUST be processed according to the DID Resolution Algorithm [<a href="bibliography.html#DID-RESOLUTION">DID-RESOLUTION</a>] to retrieve the <strong>did:btcr2</strong> DID Method-specific ID <code>method-specific-id</code>. (I.e., the first 10 characters in the string MUST be exactly <code>"did:btcr2:"</code>.)</p>
<p>Decode the <code>method-specific-id</code> as a Bech32m encoded string [<a href="bibliography.html#BIP350">BIP350</a>] to retrieve the unencoded data bytes and <code>hrp</code>. Parse the unencoded data bytes according to <a href="algorithms.html#unencoded-data-bytes">Table 2: Unencoded Data Bytes</a> to retrieve the <code>btcr2_version</code>, <code>network_value</code> and <code>genesis_bytes</code>.</p>
<ul>
<li><code>btcr2_version</code> MUST be <code>0</code>. Introduce <code>version_number</code> as <code>btcr2_version + 1</code>. I.e., <code>version_number</code> MUST be returned to the caller as a type that can be represented as the value <code>1</code>.</li>
<li><code>network_value</code> MUST be one of the values in <a href="algorithms.html#network-values">Table 1: Network Values</a>. <code>network_name</code> SHOULD be returned to the caller including additional type information using symbolic names that can be represented as integer values.</li>
<li>The <code>hrp</code> MUST be either <code>"k"</code> or <code>"x"</code>.</li>
</ul>
<p>If the <code>hrp</code> is <code>"k"</code> (key-based <strong>btcr2:did</strong> identifier), <code>key_or_hash</code> MUST be <code>genesis_bytes</code> interpreted as a 33-byte SEC encoded secp256k1 public key.</p>
<p>If the <code>hrp</code> is <code>"x"</code> (<a href="./terminology.html#genesis-document">Genesis Document</a>-based <strong>btcr2:did</strong> identifier), <code>key_or_hash</code> MUST be <code>genesis_bytes</code> interpreted as a 32-byte SHA-256 hash of a <a href="./terminology.html#genesis-document">Genesis Document</a>.</p>
<div class="tabs" id="identifier-decoding-example">
  <div class="tablist" role="tablist" aria-label="identifier-decoding-example">
    <button role="tab"
            id="identifier-decoding-example-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="identifier-decoding-example-panel-hide"
            data-tab="identifier-decoding-example-panel-hide">
Hide
    </button>
    <button role="tab"
            id="identifier-decoding-example-tab-show"
            aria-selected="false"
            class=""
            aria-controls="identifier-decoding-example-panel-show"
            data-tab="identifier-decoding-example-panel-show">
Show Example
    </button>
  </div>
  <section id="identifier-decoding-example-panel-hide"
           role="tabpanel"
           aria-labelledby="identifier-decoding-example-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="identifier-decoding-example-panel-show"
           role="tabpanel"
           aria-labelledby="identifier-decoding-example-tab-show"
           hidden>
    <label>Show Example</label>
<p>Example input:</p>
<ul>
<li><code>did</code>: <code>"did:btcr2:x1qhjw6jnhwcyu5wau4x0cpwvz74c3g82c3uaehqpaf7lzfgmnwsd7spmmf54"</code></li>
</ul>
<p>Example output:</p>
<ul>
<li><code>version_number</code>: <code>1</code></li>
<li><code>network_name</code>: <code>mutinynet</code> (<code>network_value</code> = <code>5</code>)</li>
<li><code>key_or_hash</code>: SHA-256 hash <code>e4ed4a777609ca3bbca99f80b982f571141d588f3b9b803d4fbe24a373741be8</code></section>
</li>
</ul>
</div>
<h2 id="json-document-hashing"><a class="header" href="#json-document-hashing">JSON Document Hashing</a></h2>
<ul>
<li>Encode the document using JCS [<a href="bibliography.html#RFC8785">RFC8785</a>].</li>
<li>Hash the encoded document with SHA-256 [<a href="bibliography.html#SHA256">SHA256</a>].</li>
</ul>
<h2 id="smt-proof-verification"><a class="header" href="#smt-proof-verification">SMT Proof Verification</a></h2>
<p>To verify the inclusion or non-inclusion of a DID in the <a href="./terminology.html#smt-proof">SMT Proof</a>, perform the following steps:</p>
<p>Construct a hashed-zero cache. Two zero leaves are hashed together by concatenating the value <code>0</code> with itself for the bottom level, and then hashed again with its next sibling, also itself, at each level up the tree. Each computed hash value can be cached in an array.</p>
<div class="tabs" id="construct_hashed_zero_cache">
  <div class="tablist" role="tablist" aria-label="construct_hashed_zero_cache">
    <button role="tab"
            id="construct_hashed_zero_cache-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="construct_hashed_zero_cache-panel-hide"
            data-tab="construct_hashed_zero_cache-panel-hide">
Hide
    </button>
    <button role="tab"
            id="construct_hashed_zero_cache-tab-show"
            aria-selected="false"
            class=""
            aria-controls="construct_hashed_zero_cache-panel-show"
            data-tab="construct_hashed_zero_cache-panel-show">
Show Pseudocode
    </button>
  </div>
  <section id="construct_hashed_zero_cache-panel-hide"
           role="tabpanel"
           aria-labelledby="construct_hashed_zero_cache-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="construct_hashed_zero_cache-panel-show"
           role="tabpanel"
           aria-labelledby="construct_hashed_zero_cache-tab-show"
           hidden>
    <label>Show Pseudocode</label>
<pre><code class="language-rust">let cachedZero = [];
let z = 0;
for i in 0..=255 {
  z = hash(concat(z, z));
  cachedZero[i] = z;
}</code></pre>
  </section>
</div>
<p>The <a href="./data-structures.html#smt-proof">SMT Proof (data structure)</a> is verified by walking the tree starting from the leaf node value, given by <code>hash(hash(proof.nonce) + proof.updateId)</code>, to the root <code>proof.id</code>. Walking the tree means hashing sibling hashes from <code>proof.hashes</code> concatenated with a candidate hash to construct each node value. Each bit within the leaf node index (given by <code>hash(did)</code>) informs the algorithm which side of the concatenation operation the sibling hash belongs on: 0 for left, 1 for right.</p>
<p>The tree is “optimized” by collapsing empty nodes. (See <a href="./appendix.html#smt-implementation">Appendix: Optimized Sparse Merkle Tree Implementation</a> for definition of “optimized”.) Each bit within <code>proof.collapsed</code> informs the algorithm whether to take the next sibling hash from <code>proof.hashes</code> (0) or use a hashed zero from the current height of the tree (1).</p>
<p>The last step is asserting that the computed candidate hash is equivalent to <code>proof.id</code> (the Merkle root).</p>
<div class="tabs" id="pseudocode_smt_proof_verification">
  <div class="tablist" role="tablist" aria-label="pseudocode_smt_proof_verification">
    <button role="tab"
            id="pseudocode_smt_proof_verification-tab-hide"
            aria-selected="true"
            class="is-active"
            aria-controls="pseudocode_smt_proof_verification-panel-hide"
            data-tab="pseudocode_smt_proof_verification-panel-hide">
Hide
    </button>
    <button role="tab"
            id="pseudocode_smt_proof_verification-tab-show"
            aria-selected="false"
            class=""
            aria-controls="pseudocode_smt_proof_verification-panel-show"
            data-tab="pseudocode_smt_proof_verification-panel-show">
Show Pseudocode
    </button>
  </div>
  <section id="pseudocode_smt_proof_verification-panel-hide"
           role="tabpanel"
           aria-labelledby="pseudocode_smt_proof_verification-tab-hide"
           >
    <label>Hide</label>
  </section>
  <section id="pseudocode_smt_proof_verification-panel-show"
           role="tabpanel"
           aria-labelledby="pseudocode_smt_proof_verification-tab-show"
           hidden>
    <label>Show Pseudocode</label>
<pre><code class="language-rust">let candidateHash = hash(concat(hash(proof.nonce), proof.updateId))
let index = hash(did)
for n in 0..=255 {
  let i = 255 - n;

  let siblingHash = if proof.collapsed[i] == 1 {
    cachedZero[n]
  } else {
    proof.hashes.pop_front()
  };

  if index[i] == 1 {
    candidateHash = hash(concat(siblingHash, candidateHash));
  } else {
    candidateHash = hash(concat(candidateHash, siblingHash));
  }
}

return candidateHash == proof.id;</code></pre>
  </section>
</div>
<!-- Line breaks to visibly separate the preceding subsection from the chapter footnotes. -->
<br>
<br>
<hr>
<ol class="footnote-definition"><li id="footnote-1">
<p>Little Endian. <a href="#fr-1-1">↩</a> <a href="#fr-1-2">↩2</a></p>
</li>
<li id="footnote-2">
<p>The “Index” is a Little Endian bit count starting from <code>0</code> on the left and ending in <code>263</code> or <code>271</code> on the right (inclusive). <a href="#fr-2-1">↩</a></p>
</li>
</ol><div style="break-before: page; page-break-before: always;"></div><h1 id="errors"><a class="header" href="#errors">Errors</a></h1>
<p>The algorithms described in this specification can raise the specific errors listed below. Additional error types defined in Section 10 of DID Resolution v0.3 [<a href="bibliography.html#DID-RESOLUTION">DID-RESOLUTION</a>] may also be raised.</p>
<p>These errors are assumed to be fatal and all <strong>did:btcr2</strong> operations must abort when one of these errors are raised.</p>
<h2 id="invalid_did_update"><a class="header" href="#invalid_did_update"><code>INVALID_DID_UPDATE</code></a></h2>
<p>An error was found when creating or applying a <a href="./terminology.html#btcr2-update">BTCR2 Update</a>.</p>
<h2 id="late_publishing"><a class="header" href="#late_publishing"><code>LATE_PUBLISHING</code></a></h2>
<p>An error was found when processing the full history of <a href="./terminology.html#btcr2-update">BTCR2 Updates</a> announced by all relevant <a href="./terminology.html#beacon-signal">Beacon Signals</a>. See <a href="./terminology.html#late-publishing">Late Publishing</a>.</p>
<h2 id="missing_update_data"><a class="header" href="#missing_update_data"><code>MISSING_UPDATE_DATA</code></a></h2>
<p><a href="./terminology.html#btcr2-update">BTCR2 Update</a> data can not be found in either the provided <a href="./terminology.html#sidecar-data">Sidecar Data</a> nor in <a href="./terminology.html#cas">CAS</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="appendix"><a class="header" href="#appendix">Appendix</a></h1>
<p>The appendix contains privacy and security considerations made by the developers of this specification. This section is designed to complement the main specification and provide additional rationale, edge-case analyses, and guidance intended to help implementers understand subtle aspects of the BTCR2 design.</p>
<h2 id="btcr2-update-aggregation-1"><a class="header" href="#btcr2-update-aggregation-1">BTCR2 Update Aggregation</a></h2>
<p>Below are two design considerations regarding how BTCR2 handles the update aggregation. It outlines the trust assumptions, describes how multi-party signing preserves the controller’s authority, and discusses the expected behavior and failure modes inherent in aggregated beacon-based updates.</p>
<h3 id="no-privileged-role"><a class="header" href="#no-privileged-role">No Privileged Role</a></h3>
<p>Although update aggregation in <strong>did:btcr2</strong> does depend on some party (or protocol) acting as the <a href="./terminology.html#aggregation-service">Aggregation Service</a> (i.e., coordinator and publisher) of <a href="./terminology.html#beacon-signal">Beacon Signals</a>, that role may be satisfied by any party. To ensure that the <a href="./terminology.html#aggregation-service">Aggregation Service</a> gains no specific benefit with regard to the authority to publish a <a href="./terminology.html#beacon-signal">Beacon Signal</a>, those participating in aggregation SHOULD use a protocol that ensures every <a href="./terminology.html#aggregation-participant">Aggregation Participant</a> in the <a href="./terminology.html#aggregation-cohort">Aggregation Cohort</a> has explicitly signed the <a href="./terminology.html#beacon-signal">Beacon Signal</a> itself. It is RECOMMENDED that <a href="./terminology.html#aggregate-beacon">Aggregate Beacons</a> use a <a href="./terminology.html#beacon-address">Beacon Address</a> that requires an n-of-n <a href="./terminology.html#schnorr-signature">Schnorr Signature</a> where each <a href="./terminology.html#aggregation-participant">Aggregation Participant</a> explicitly signs in a provable manner.</p>
<h3 id="worst-case"><a class="header" href="#worst-case">Worst Case</a></h3>
<p>Since aggregation depends on others, it should be expected that any given <a href="./terminology.html#btcr2-beacon">BTCR2 Beacon</a> might fail. Perhaps the <a href="./terminology.html#aggregation-service">Aggregation Service</a> stops providing the service or a peer in the <a href="./terminology.html#aggregation-cohort">Aggregation Cohort</a> stops signing their portion of the <a href="./terminology.html#beacon-signal">Beacon Signal</a>. The best practice to avoid complete failure is to have at least one <a href="./terminology.html#singleton-beacon">Singleton Beacon</a> in every DID document, ensuring a fallback mechanism should all <a href="./terminology.html#aggregate-beacon">Aggregate Beacons</a> fail.</p>
<p>However, even in the case of failure at the aggregation layer, only two negative consequence are possible:</p>
<ol>
<li>
<p>If the <a href="./terminology.html#beacon-signal">Beacon Signal</a> does not require n-of-n signing, a hostile <a href="./terminology.html#aggregation-cohort">Aggregation Cohort</a> (or <a href="./terminology.html#aggregation-service">Aggregation Service</a>) could invalidate the DID by publishing a <a href="./terminology.html#beacon-signal">Beacon Signal</a> with a malformed update.</p>
</li>
<li>
<p>When the <a href="./terminology.html#beacon-signal">Beacon Signal</a> does require n-of-n signing, a hostile <a href="./terminology.html#aggregation-cohort">Aggregation Cohort</a> (or <a href="./terminology.html#aggregation-service">Aggregation Service</a>) could render that Beacon inoperable, preventing publication of <a href="./terminology.html#btcr2-update">BTCR2 Updates</a> through that address. However, this has no effect on other beacons.</p>
</li>
</ol>
<p>In no case is it possible for a [Beacon Participant] other than the DID controller to compromise the DID document itself. All <a href="./terminology.html#btcr2-update">BTCR2 Updates</a> remain cryptographically secured. Compromising the DID document requires compromising the controller’s key store: a threat which is already the primary attack vector for compromising DIDs. No new threats to DID document provenance are created by aggregation.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="privacy-considerations"><a class="header" href="#privacy-considerations">Privacy Considerations</a></h1>
<h2 id="design-considerations"><a class="header" href="#design-considerations">Design Considerations</a></h2>
<h3 id="updates-can-be-private"><a class="header" href="#updates-can-be-private">Updates Can Be Private</a></h3>
<p><strong>did:btcr2</strong> was designed such that updates to Decentralized Identifier (DID) documents are NOT REQUIRED to be public. Bitcoin is used to publicly announce and anchor updates to DID documents, however the updates themselves can be kept private by DID controllers and provided through a <a href="appendix/../terminology.html#sidecar">Sidecar</a> mechanism at Resolution Time.</p>
<h3 id="did-documents-can-be-private"><a class="header" href="#did-documents-can-be-private">DID Documents Can Be Private</a></h3>
<p>Since updates to DID documents are NOT REQUIRED to be public, neither are <strong>did:btcr2</strong> DID documents. A <strong>did:btcr2</strong> DID document is an initial document plus a series of updates to that DID document. To keep the DID document fully private, the DID controller can choose to use an externally resolved initial <strong>did:btcr2</strong> and not place the initial DID document on a <a href="appendix/../terminology.html#content-addressable-storage">Content Addressable Storage</a> (CAS) system such as the InterPlanetary File System (IPFS). The initial DID document can be provided at Resolution Time through a <a href="appendix/../terminology.html#sidecar">Sidecar</a> mechanism along with the collection of <a href="appendix/../terminology.html#btcr2-update">BTCR2 Updates</a> that can be verified against the relevant <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a> for the DID being resolved.</p>
<h3 id="offline-did-creation"><a class="header" href="#offline-did-creation">Offline DID Creation</a></h3>
<p><strong>did:btcr2</strong> was designed to support offline creation, that is, the generation of a <strong>did:btcr2</strong> identifier and associated DID document without any network calls to the Bitcoin blockchain. This is possible in both deterministic and externally resolvable DIDs.</p>
<h3 id="aggregation-services-only-need-hashes"><a class="header" href="#aggregation-services-only-need-hashes">Aggregation Services Only Need Hashes</a></h3>
<p><a href="appendix/../terminology.html#aggregation-service">Aggregation Services</a> in <strong>did:btcr2</strong> are entities that coordinate <a href="appendix/../terminology.html#aggregate-beacon">Aggregate Beacons</a> and the corresponding <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a> that announce and anchor an aggregated set of <a href="appendix/../terminology.html#btcr2-update">BTCR2 Updates</a>. However, in <strong>did:btcr2</strong>, aggregators are able to coordinate <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a> without needing to view or validate DID documents or the updates. Instead, they are provided with a hash or <a href="appendix/../terminology.html#content-identifier">Content Identifier</a> (CID) of the update for a specific DID which they include in the <a href="appendix/../terminology.html#beacon-signal">Beacon Signal</a> according to the type of the <a href="appendix/../terminology.html#btcr2-beacon">BTCR2 Beacon</a>.</p>
<h3 id="consensus-splits-break-non-repudiation"><a class="header" href="#consensus-splits-break-non-repudiation">Consensus Splits Break Non-Repudiation</a></h3>
<p>Because <a href="appendix/../terminology.html#non-repudiation">Non-Repudiation</a> requires following a complete stream of updates to a DID, any consensus forks in which DID updates to apply can be used to permanently diverge the history for a DID, and thus the key material, creating alternate attestation histories.</p>
<p>As a concrete example, a seemingly small difference between two clients in interpretation of the specification could be used fraudulently to sign a loan in one history and claim that it was never signed in another history.</p>
<p>In order to prevent consensus splits, <strong>did:btcr2</strong> needs a particularly good test suite. It MUST be designed to challenge all the foreseeable edge cases as well as maintained to find new ones.</p>
<h2 id="deployment-considerations"><a class="header" href="#deployment-considerations">Deployment Considerations</a></h2>
<h3 id="cas-systems-lack-privacy"><a class="header" href="#cas-systems-lack-privacy">CAS Systems Lack Privacy</a></h3>
<p>Specifically, in this context, the relevant content are <a href="appendix/../terminology.html#btcr2-update">BTCR2 Updates</a> being stored in <a href="appendix/../terminology.html#content-addressable-storage">Content Addressable Storage</a> (<a href="appendix/../terminology.html#cas">CAS</a>) such as IPFS. These SHOULD be considered public. Anyone MAY retrieve this information (assuming they have the <a href="appendix/../terminology.html#cid">CID</a>) and use it to track the DID over time. IPFS node operators would have access to all content stored on IPFS and could choose to index certain data like <a href="appendix/../terminology.html#btcr2-update">BTCR2 Updates</a>, including the updates posted by a <a href="appendix/../terminology.html#btcr2-beacon">BTCR2 Beacon</a> connected to a specific DID. This MAY advertise information about the DID that the controller wishes to remain private.</p>
<p>Those parties most concerned about privacy SHOULD maintain their <a href="appendix/../terminology.html#btcr2-update">BTCR2 Updates</a> in a <a href="appendix/../terminology.html#sidecar">Sidecar</a> manner and provide them to necessary parties during resolution. It is RECOMMENDED not to include any sensitive data other than the necessary DID update data.</p>
<h3 id="aggregation-participants-provide-dids-to-aggregation-services"><a class="header" href="#aggregation-participants-provide-dids-to-aggregation-services">Aggregation Participants Provide DIDs to Aggregation Services</a></h3>
<p>Within <a href="appendix/../terminology.html#smt-beacon">SMT Beacons</a>, the DID is used as a path to an <a href="appendix/../terminology.html#smt">SMT</a> leaf node. The <a href="appendix/../terminology.html#aggregation-service">Aggregation Service</a> MUST know these paths to be able to construct the tree and generate the correct proof paths. Within <a href="appendix/../terminology.html#cas-beacon">CAS Beacons</a>, the <a href="appendix/../terminology.html#aggregation-service">Aggregation Service</a> MUST construct a <a href="appendix/../data-structures.html#cas-announcement">CAS Announcement (data structure)</a>. This means that for both types of <a href="appendix/../terminology.html#aggregate-beacon">Aggregate Beacons</a>, the <a href="appendix/../terminology.html#aggregation-service">Aggregation Service</a> necessarily MUST know all DIDs in the <a href="appendix/../terminology.html#aggregation-cohort">Aggregation Cohort</a>.</p>
<h3 id="all-dids-are-visible-to-cas-beacon-aggregation-cohort"><a class="header" href="#all-dids-are-visible-to-cas-beacon-aggregation-cohort">All DIDs are Visible to CAS Beacon Aggregation Cohort</a></h3>
<p><a href="appendix/../terminology.html#aggregation-cohort">Aggregation Cohort</a> members participating in a <a href="appendix/../terminology.html#cas-beacon">CAS Beacon</a> learn all DIDs that are updated in each <a href="appendix/../terminology.html#beacon-signal">Beacon Signal</a> because the contents of a CAS <a href="appendix/../terminology.html#beacon-signal">Beacon Signal</a> is a JSON object that maps participant <strong>did:btcr2</strong> identifiers to CID values, where each CID value is that DID’s respective <a href="appendix/../terminology.html#btcr2-update">BTCR2 Update</a>. Each DID controller SHOULD independently retrieve and verify the contents of the update bundle to ensure it contains the expected update for their DID before authorizing the <a href="appendix/../terminology.html#aggregation-service">Aggregation Service</a> creates the <a href="appendix/../data-structures.html#cas-announcement">CAS Announcement (data structure)</a> from the CAS <a href="appendix/../terminology.html#beacon-signal">Beacon Signal</a> and broadcasts it.</p>
<h3 id="non-repudiation-reveals-did-document-history"><a class="header" href="#non-repudiation-reveals-did-document-history">Non-Repudiation Reveals DID Document History</a></h3>
<p>One of the side effects of using a DID is that a DID controller’s relying party will see their DID Document. In addition, resolving a DID document requires making available to the resolver all prior DID document updates.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="security-considerations"><a class="header" href="#security-considerations">Security Considerations</a></h1>
<h2 id="late-publishing-1"><a class="header" href="#late-publishing-1">Late Publishing</a></h2>
<p><strong>did:btcr2</strong> was designed to avoid <a href="appendix/../terminology.html#late-publishing">Late Publishing</a> such that, independent of when a resolution occurs, the DID document history and provenance are guaranteed to be invariant. Resolvers MUST enforce strict ordering of the <a href="appendix/../terminology.html#btcr2-update">BTCR2 Updates</a> and process all relevant <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a>.</p>
<h2 id="invalidation-attacks"><a class="header" href="#invalidation-attacks">Invalidation Attacks</a></h2>
<p>Invalidation attacks are where adversaries are able to publish <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a> that claim to contain updates for DIDs they do not control. Due to the requirement for processing all relevant <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a>, if these updates cannot be retrieved by a resolver, the DID MUST be considered invalid. To prevent these attacks, all <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a> SHOULD be authorized by signatures: either from the DID controller when using a <a href="appendix/../terminology.html#singleton-beacon">Singleton Beacon</a> or with a <code>n-of-n</code> multisignature from all <code>n</code> members of an <a href="appendix/../terminology.html#aggregation-cohort">Aggregation Cohort</a> when using an <a href="appendix/../terminology.html#aggregate-beacon">Aggregate Beacon</a>. DID controllers SHOULD verify the updates announced within a <a href="appendix/../terminology.html#beacon-signal">Beacon Signal</a> before authorizing it.</p>
<h2 id="deployment-considerations-1"><a class="header" href="#deployment-considerations-1">Deployment Considerations</a></h2>
<h3 id="data-retention"><a class="header" href="#data-retention">Data Retention</a></h3>
<p><a href="appendix/../terminology.html#btcr2-update">BTCR2 Updates</a> MUST be available to resolver at the time of resolution. It is the responsibility of DID controllers to persist this data, otherwise the consequence is that the DID MAY not be resolvable (depending on data accessibility from the perspective of the resolver). DID controllers MAY store <a href="appendix/../terminology.html#btcr2-update">BTCR2 Updates</a> on a <a href="appendix/../terminology.html#cas">CAS</a> system. DID controllers SHOULD consider that in some constrained environments it is preferable to discard a DID and replace it with a newly issued DID, rather than rotating a key.</p>
<h3 id="aggregate-beacon-address-verification"><a class="header" href="#aggregate-beacon-address-verification">Aggregate Beacon Address Verification</a></h3>
<p>A <a href="appendix/../terminology.html#beacon-address">Beacon Address</a> of an <a href="appendix/../terminology.html#aggregate-beacon">Aggregate Beacon</a> SHOULD be an <code>n-of-n</code> Pay-to-Taproot (P2TR) address, with a key contributed to the <code>n</code> by each of the participants in an <a href="appendix/../terminology.html#aggregation-cohort">Aggregation Cohort</a>. DID controllers participating in an <a href="appendix/../terminology.html#aggregation-cohort">Aggregation Cohort</a> SHOULD verify the <a href="appendix/../terminology.html#beacon-address">Beacon Address</a> is an <code>n-of-n</code> and that one of the <code>n</code> keys is the key that they provided to the <a href="appendix/../terminology.html#aggregation-service">Aggregation Service</a>. This can be achieved only by constructing the <a href="appendix/../terminology.html#beacon-address">Beacon Address</a> for themselves using the set of keys from the <a href="appendix/../terminology.html#aggregation-cohort">Aggregation Cohort</a> that SHOULD be provided by the <a href="appendix/../terminology.html#aggregation-service">Aggregation Service</a>.</p>
<h3 id="aggregate-beacon-signal-verification"><a class="header" href="#aggregate-beacon-signal-verification">Aggregate Beacon Signal Verification</a></h3>
<p>When submitting <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a> to <a href="appendix/../terminology.html#aggregation-service">Aggregation Services</a>, a DID controller will either: announce an <a href="appendix/../terminology.html#btcr2-update">BTCR2 Update</a> for their DID or not. The DID controller SHOULD verify that the <a href="appendix/../terminology.html#beacon-signal">Beacon Signal</a> announces the <a href="appendix/../terminology.html#btcr2-update">BTCR2 Update</a> they expect (or no <a href="appendix/../terminology.html#btcr2-update">BTCR2 Update</a>) for all <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a> broadcast by <a href="appendix/../terminology.html#aggregation-service">Aggregation Services</a> before final authorization. If they do not, then invalidation attacks become possible where a <a href="appendix/../terminology.html#beacon-signal">Beacon Signal</a> announces a <a href="appendix/../terminology.html#btcr2-update">BTCR2 Update</a> that cannot be retrieved for a particular DID, causing the DID to be invalidated.</p>
<h3 id="key-compromise"><a class="header" href="#key-compromise">Key Compromise</a></h3>
<p>In <strong>did:btcr2</strong>, cryptographic keys authorize both <a href="appendix/../terminology.html#btcr2-update">BTCR2 Updates</a> and <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a>. Should these keys get compromised without the DID controller’s knowledge, it would be possible for an adversary to take control of a DID by submitting a <a href="appendix/../terminology.html#btcr2-update">BTCR2 Update</a> to a <a href="appendix/../terminology.html#btcr2-beacon">BTCR2 Beacon</a> that replaces key material and <a href="appendix/../terminology.html#btcr2-beacon">BTCR2 Beacons</a> in the DID document for ones under the adversary’s control. Such an attack would be detectable by the DID controller, as they would see a valid spend from a <a href="appendix/../terminology.html#btcr2-beacon">BTCR2 Beacon</a> that they did not authorize. Additionally, if the DID relied on <a href="appendix/../terminology.html#sidecar-data">Sidecar Data</a>, without access to this data the DID would be useless to the adversary as they would be unable to demonstrate a valid complete history of the DID during resolution.</p>
<h3 id="cryptographic-compromise"><a class="header" href="#cryptographic-compromise">Cryptographic Compromise</a></h3>
<p>The security of <strong>did:btcr2</strong> identifiers depends on the security of <a href="appendix/../terminology.html#schnorr-signature">Schnorr Signatures</a> over the secp256k1 curve. It is this signature scheme that is used to secure both the <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a> and <a href="appendix/../terminology.html#btcr2-update">BTCR2 Updates</a>. Should vulnerabilities be discovered in this scheme or if advancements in quantum computing compromise its cryptographic foundations, the <strong>did:btcr2</strong> method would become obsolete.</p>
<h3 id="bitcoin-blockchain-compromise"><a class="header" href="#bitcoin-blockchain-compromise">Bitcoin Blockchain Compromise</a></h3>
<p>The security of <strong>did:btcr2</strong> identifiers depends on the security of the Bitcoin blockchain. Should the Bitcoin blockchain become compromised such that its history could be rewritten, for example through a 51% attack, then <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a> that were once part of the blockchain could be removed or replaced – although the longer these <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a> have been included in the blockchain the more difficult this becomes. A 51% attack could prevent future <a href="appendix/../terminology.html#beacon-signal">Beacon Signals</a> from being included within the network, however this would require the 51% attack to remain indefinitely enforced. Furthermore, without key compromise related to a specific DID, the compromise of the Bitcoin blockchain would not enable adversarial parties to take control of a DID.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="smt-implementation"><a class="header" href="#smt-implementation">Optimized Sparse Merkle Tree Implementation</a></h1>
<p>From <a href="https://en.wikipedia.org/wiki/Merkle_tree">Wikipedia</a>:</p>
<blockquote>
<p>In cryptography and computer science, a hash tree or Merkle tree is a tree in which every “leaf” node is labelled with the cryptographic hash of a data block, and every node that is not a leaf (called a branch, inner node, or inode) is labeled with the cryptographic hash of the labels of its child nodes. A hash tree allows efficient and secure verification of the contents of a large data structure. A hash tree is a generalization of a hash list and a hash chain.</p>
</blockquote>
<pre class="mermaid">flowchart TD
    classDef rootHash color:#000000,fill:#fb8500
    classDef nodeHash color:#000000,fill:#219ebc
    classDef leafHash color:#ffffff,fill:#023047
    classDef dataBlock color:#000000,fill:#ffb703

    RootHash[&quot;`Root Hash
    *hash(Hash 0 + Hash 1)*`&quot;]:::rootHash

    RootHash --&gt; Hash0[&quot;`Hash 0
    *hash(Hash 00 + Hash 01)*`&quot;]:::nodeHash
    RootHash --&gt; Hash1[&quot;`Hash 1
    *hash(Hash 10 + Hash 11)*`&quot;]:::nodeHash

    Hash0 --&gt; Hash00[&quot;`Hash 00
    *hash(Hash 000 + Hash 001)*`&quot;]:::nodeHash
    Hash0 --&gt; Hash01[&quot;`Hash 01
    *hash(Hash 010 + Hash 011)*`&quot;]:::nodeHash

    Hash1 --&gt; Hash10[&quot;`Hash 10
    *hash(Hash 100 + Hash 101)*`&quot;]:::nodeHash
    Hash1 --&gt; Hash11[&quot;`Hash 11
    *hash(Hash 110 + Hash 111)*`&quot;]:::nodeHash

    Hash00 --&gt; Hash000[&quot;`Hash 000
    *hash(Hash 0000 + Hash 0001)*`&quot;]:::nodeHash
    Hash00 --&gt; Hash001[&quot;`Hash 001
    *hash(Hash 0010 + Hash 0011)*`&quot;]:::nodeHash

    Hash01 --&gt; Hash010[&quot;`Hash 010
    *hash(Hash 0100 + Hash 0101)*`&quot;]:::nodeHash
    Hash01 --&gt; Hash011[&quot;`Hash 011
    *hash(Hash 0110 + Hash 0111)*`&quot;]:::nodeHash

    Hash10 --&gt; Hash100[&quot;`Hash 100
    *hash(Hash 1000 + Hash 1001)*`&quot;]:::nodeHash
    Hash10 --&gt; Hash101[&quot;`Hash 101
    *hash(Hash 1010 + Hash 1011)*`&quot;]:::nodeHash

    Hash11 --&gt; Hash110[&quot;`Hash 110
    *hash(Hash 1100 + Hash 1101)*`&quot;]:::nodeHash
    Hash11 --&gt; Hash111[&quot;`Hash 111
    *hash(Hash 1110 + Hash 1111)*`&quot;]:::nodeHash

    Hash000 --&gt; Hash0000[&quot;`Hash 0000
    *hash(Data Block 0000)*`&quot;]:::leafHash
    Hash000 --&gt; Hash0001[&quot;`Hash 0001
    *hash(Data Block 0001)*`&quot;]:::leafHash

    Hash001 --&gt; Hash0010[&quot;`Hash 0010
    *hash(Data Block 0010)*`&quot;]:::leafHash
    Hash001 --&gt; Hash0011[&quot;`Hash 0011
    *hash(Data Block 0011)*`&quot;]:::leafHash

    Hash010 --&gt; Hash0100[&quot;`Hash 0100
    *hash(Data Block 0100)*`&quot;]:::leafHash
    Hash010 --&gt; Hash0101[&quot;`Hash 0101
    *hash(Data Block 0101)*`&quot;]:::leafHash

    Hash011 --&gt; Hash0110[&quot;`Hash 0110
    *hash(Data Block 0110)*`&quot;]:::leafHash
    Hash011 --&gt; Hash0111[&quot;`Hash 0111
    *hash(Data Block 0111)*`&quot;]:::leafHash

    Hash100 --&gt; Hash1000[&quot;`Hash 1000
    *hash(Data Block 1000)*`&quot;]:::leafHash
    Hash100 --&gt; Hash1001[&quot;`Hash 1001
    *hash(Data Block 1001)*`&quot;]:::leafHash

    Hash101 --&gt; Hash1010[&quot;`Hash 1010
    *hash(Data Block 1010)*`&quot;]:::leafHash
    Hash101 --&gt; Hash1011[&quot;`Hash 1011
    *hash(Data Block 1011)*`&quot;]:::leafHash

    Hash110 --&gt; Hash1100[&quot;`Hash 1100
    *hash(Data Block 1100)*`&quot;]:::leafHash
    Hash110 --&gt; Hash1101[&quot;`Hash 1101
    *hash(Data Block 1101)*`&quot;]:::leafHash

    Hash111 --&gt; Hash1110[&quot;`Hash 1110
    *hash(Data Block 1110)*`&quot;]:::leafHash
    Hash111 --&gt; Hash1111[&quot;`Hash 1111
    *hash(Data Block 1111)*`&quot;]:::leafHash

    Hash0000 --&gt; DataBlock0000[(&quot;Data Block 0000&quot;)]:::dataBlock
    Hash0001 --&gt; DataBlock0001[(&quot;Data Block 0001&quot;)]:::dataBlock
    Hash0010 --&gt; DataBlock0010[(&quot;Data Block 0010&quot;)]:::dataBlock
    Hash0011 --&gt; DataBlock0011[(&quot;Data Block 0011&quot;)]:::dataBlock
    Hash0100 --&gt; DataBlock0100[(&quot;Data Block 0100&quot;)]:::dataBlock
    Hash0101 --&gt; DataBlock0101[(&quot;Data Block 0101&quot;)]:::dataBlock
    Hash0110 --&gt; DataBlock0110[(&quot;Data Block 0110&quot;)]:::dataBlock
    Hash0111 --&gt; DataBlock0111[(&quot;Data Block 0111&quot;)]:::dataBlock
    Hash1000 --&gt; DataBlock1000[(&quot;Data Block 1000&quot;)]:::dataBlock
    Hash1001 --&gt; DataBlock1001[(&quot;Data Block 1001&quot;)]:::dataBlock
    Hash1010 --&gt; DataBlock1010[(&quot;Data Block 1010&quot;)]:::dataBlock
    Hash1011 --&gt; DataBlock1011[(&quot;Data Block 1011&quot;)]:::dataBlock
    Hash1100 --&gt; DataBlock1100[(&quot;Data Block 1100&quot;)]:::dataBlock
    Hash1101 --&gt; DataBlock1101[(&quot;Data Block 1101&quot;)]:::dataBlock
    Hash1110 --&gt; DataBlock1110[(&quot;Data Block 1110&quot;)]:::dataBlock
    Hash1111 --&gt; DataBlock1111[(&quot;Data Block 1111&quot;)]:::dataBlock
</pre>
<p>To use Merkle trees to signal commitments in <a href="appendix/../terminology.html#btcr2-beacon">BTCR2 Beacons</a>:</p>
<ul>
<li>The index (the identification of the leaf node) is the hash of the DID with the hash byte stream converted to an integer using big-endian conversion, i.e., <code>index = int(hash(did))</code>.
<ul>
<li>Each DID is therefore associated with one and only one leaf node.</li>
<li>Binding the index to the DID ensures that no other index can be used by a nefarious actor to post an update to the DID.</li>
<li>This produces a data structure with lots of unused leaves, making it a <a href="appendix/../terminology.html#sparse-merkle-tree">Sparse Merkle Tree</a>.</li>
</ul>
</li>
<li>The value stored at a leaf node is the hash of a 256-bit nonce, concatenated with the hash of the <a href="appendix/../terminology.html#btcr2-update">BTCR2 Update</a> (the <a href="appendix/../terminology.html#btcr2-update-announcement">BTCR2 Update Announcement</a>) if available, then the resulting stream is hashed again. I.e., <code>value = hash(hash(nonce) + hash(btcr2Update))</code> if there is a <a href="appendix/../terminology.html#btcr2-update">BTCR2 Update</a> or <code>value = hash(hash(nonce))</code> if there is not.
<ul>
<li>Provided that it is unique per DID and per signal, the use of a nonce ensures that updates and non-updates are indistinguishable to outside parties (aggregators, other DID controllers, verifiers) unless explicitly informed by the DID controller.</li>
<li>The hashing of the nonce ensures that verifiers with limited input validation deal only with a 256-bit result.</li>
</ul>
</li>
<li>A node with two empty children is itself empty.</li>
<li>The value of a node with one empty child and one non-empty child is the value of the non-empty child.
<ul>
<li>This limits work to only those points in the tree where non-empty indexes diverge.</li>
</ul>
</li>
<li>The value of a node with two non-empty children is the hash of the concatenation of the left value (bit 0) and the right value (bit 1), i.e., <code>node_value = hash(left_value + right_value)</code>.</li>
<li>The only thing published in the <a href="appendix/../terminology.html#beacon-signal">Beacon Signal</a> is the root hash (the Merkle root).</li>
</ul>
<p>Let’s assume that indexes 0 (<code>0000</code>), 2 (<code>0010</code>), 5 (<code>0101</code>), 9 (<code>1001</code>), 13 (<code>1101</code>), and 14 (<code>1110</code>) have DIDs associated with them; and a signal includes updates for DIDs 2, 9, and 13 and non-updates for all others.</p>
<p>The collapsed tree, where empty branches have been trimmed and single-child nodes have been removed, looks like this (note that the positions of nodes <code>Hash 1001</code> and <code>Hash 11</code> are reversed due to the Mermaid layout algorithm):</p>
<pre class="mermaid">flowchart TD
    classDef rootHash color:#000000,fill:#fb8500
    classDef nodeHash color:#000000,fill:#219ebc
    classDef leafHash color:#ffffff,fill:#023047
    classDef dataBlock color:#000000,fill:#ffb703

    RootHash[&quot;`Root Hash
    *hash(Hash 0 + Hash 1)*`&quot;]:::rootHash

    RootHash --&gt; Hash0[&quot;`Hash 0
    *hash(Hash 00 + Hash 0101)*`&quot;]:::nodeHash
    RootHash --&gt; Hash1[&quot;`Hash 1
    *hash(Hash 1001 + Hash 11)*`&quot;]:::nodeHash

    Hash0 --&gt; Hash00[&quot;`Hash 00
    *hash(Hash 0000 + Hash 0010)*`&quot;]:::nodeHash
    Hash0 --&gt; Hash0101[&quot;`Hash 0101
    *hash(hash(Nonce 0101))*`&quot;]:::leafHash

    Hash1 --&gt; Hash1001[&quot;`Hash 1001
    *hash(hash(Nonce 1001) + hash(Data Block 1001))*`&quot;]:::leafHash
    Hash1 --&gt; Hash11[&quot;`Hash 11
    *hash(Hash 1101 + Hash 1110)*`&quot;]:::nodeHash

    Hash00 --&gt; Hash0000[&quot;`Hash 0000
    *hash(hash(Nonce 0000))*`&quot;]:::leafHash
    Hash00 --&gt; Hash0010[&quot;`Hash 0010
    *hash(hash(Nonce 0010) + hash(Data Block 0010))*`&quot;]:::leafHash

    Hash11 --&gt; Hash1101[&quot;`Hash 1101
    *hash(hash(Nonce 1101) + hash(Data Block 1101))*`&quot;]:::leafHash
    Hash11 --&gt; Hash1110[&quot;`Hash 1110
    *hash(hash(Nonce 1110))*`&quot;]:::leafHash

    Hash0010 --&gt; DataBlock0010[(&quot;Data Block 0010&quot;)]:::dataBlock
    Hash1001 --&gt; DataBlock1001[(&quot;Data Block 1001&quot;)]:::dataBlock
    Hash1101 --&gt; DataBlock1101[(&quot;Data Block 1101&quot;)]:::dataBlock
</pre>
<p>The DID controller has to prove that there is either an update or a non-update in the <a href="appendix/../terminology.html#beacon-signal">Beacon Signal</a>. To prove an update, the DID controller provides the nonce and either the <a href="appendix/../terminology.html#btcr2-update">BTCR2 Update</a> or the hash; to prove a non-update, the DID controller provides the nonce. In addition, the DID controller provides the list of collapsed nodes and hashes of each peer in the tree necessary to recalculate the root hash against which to compare with the value in the <a href="appendix/../terminology.html#beacon-signal">Beacon Signal</a>.</p>
<p>Assuming that the DID of interest is at index 13 (<code>int(hash(did)) == int(1101) == 13</code>), the <a href="appendix/../terminology.html#aggregation-service">Aggregation Service</a> (the party responsible for constructing the <a href="appendix/../terminology.html#sparse-merkle-tree">Sparse Merkle Tree</a>) must provide the DID controller with a list of collapsed nodes above leaf node 13 and a list of hashes of the peers for uncollapsed nodes.</p>
<p>The <a href="appendix/../terminology.html#aggregation-service">Aggregation Service</a> has the full <a href="appendix/../terminology.html#sparse-merkle-tree">Sparse Merkle Tree</a> and can construct <a href="appendix/../terminology.html#smt-proof">SMT Proofs</a>. DID controllers request the <a href="appendix/../terminology.html#smt-proof">SMT Proofs</a> from the <a href="appendix/../terminology.html#aggregation-service">Aggregation Service</a> and give them to verifiers. An example proof may be:</p>
<pre><code class="language-json">{
  "id": "&lt;&lt; Hexadecimal of Root Hash &gt;&gt;",
  "nonce": "&lt;&lt; Hexadecimal of Nonce 1101 &gt;&gt;",
  "updateId": "&lt;&lt; Hexadecimal of hash(Data Block 1101) &gt;&gt;",
  "collapsed": "&lt;&lt; Hexadecimal of 0001 &gt;&gt;",
  "hashes": [
      "&lt;&lt; Hexadecimal of Hash 1110 &gt;&gt;",
      "&lt;&lt; Hexadecimal of Hash 1001 &gt;&gt;",
      "&lt;&lt; Hexadecimal of Hash 0 &gt;&gt;"
  ]
}
</code></pre>
<p>With an <a href="appendix/../terminology.html#smt-proof">SMT Proof</a>, the verifier has everything necessary to verify that the <a href="appendix/../terminology.html#btcr2-update">BTCR2 Update</a> is included or not. Assuming that the verifier can match the root hash in the <a href="appendix/../terminology.html#beacon-signal">Beacon Signal</a> to <code>proof.id</code> and the <a href="appendix/../terminology.html#btcr2-update">BTCR2 Update</a> to <code>proof.updateId</code>, the proof is verified as follows:</p>
<pre><code class="language-javascript">index = int(hash(did)) // 1101

candidateHash = hash(hash(proof.nonce) + proof.updateId)

// First collapsed bit from right is 1, so index bit doesn't apply.
// Skip first index bit.
// Candidate hash is unchanged.

// Next collapsed bit from right is 0, so index bit applies.
// Next index bit from right is 0.
// Candidate hash goes to the left against the next listed hash.
candidateHash = hash(candidateHash + "Hash 1110")

// Next collapsed bit from right is 0, so index bit applies.
// Next index bit from right is 1.
// Candidate hash goes to the right against the next listed hash.
candidateHash = hash("Hash 1001" + candidateHash)

// Next collapsed bit from right is 0, so index bit applies.
// Next index bit from right is 1.
// Candidate hash goes to the right against the next listed hash.
candidateHash = hash("Hash 0" + candidateHash)

// Hashes exhausted.
// Candidate hash must equal root hash.
assert(candidateHash === proof.id)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="references"><a class="header" href="#references">References</a></h1>
<script type="text/javascript">
function defaultCopyTextToClipboard(text) {
    var textArea = document.createElement("textarea");
    textArea.value = text;

    // Avoid scrolling to bottom
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";

    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();

    try {
        var ok = document.execCommand('copy');
        var msg = ok ? 'was ok' : 'failed';
        console.log('Backing copy: Text copy was ' + msg);
    } catch (err) {
        console.error('Backing copy: Unable to copy text', err);
    }

    document.body.removeChild(textArea);
}

function copyToClipboard(text) {
    if (!navigator.clipboard) {
        defaultCopyTextToClipboard(text);
        return;
    }
    navigator.clipboard.writeText(text).then(function() {
        console.log('Text copied to clipboard');
    }, function(err) {
        console.error('Error copying text: ', err);
    });
}

</script>
<style>div.bib_div h2 {
    margin-block-start: 0.5em;
}

div.bib_div hr {
    margin-block-start: 1.5em;
}

div.bib_div:last-of-type hr {
    display: none;
}

div.bib_div section.abstract {
    margin-left: 1.5em;
}
</style>
<div class="bib_div">
<details data-key="BCP14" class="ref">
<summary class="citation">
<a id="BCP14">[BCP14]</a>
- N/A
- <a href="https://www.rfc-editor.org/info/bcp14" target="_blank"><cite>Best Current Practice 14: Key words for use in RFCs to Indicate Requirement Levels</cite></a>.
- 2017.
</summary>
<section class="abstract">
<h2 id="summaryabstract"><a class="header" href="#summaryabstract">Summary/Abstract</a></h2>
<div>BCP 14 is the Best Current Practice that defines and clarifies the usage of requirement-level keywords (MUST, SHOULD, MAY, etc.) in IETF documents. It comprises RFC 2119 (defining the keywords) and RFC 8174 (clarifying that only uppercase usage carries the defined semantics).</div>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="Bitcoin-Core" class="ref">
<summary class="citation">
<a id="Bitcoin-Core">[Bitcoin-Core]</a>
- Bitcoin Core Developers
- <a href="https://github.com/bitcoin/bitcoin" target="_blank"><cite>Bitcoin Core</cite></a>.
- 2025.
</summary>
<section class="abstract">
<h2 id="summaryabstract-1"><a class="header" href="#summaryabstract-1">Summary/Abstract</a></h2>
<div>Bitcoin Core is the reference implementation of the Bitcoin protocol. It is a full node implementation that validates all transactions and blocks according to the Bitcoin consensus rules.</div>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="BIP321" class="ref">
<summary class="citation">
<a id="BIP321">[BIP321]</a>
- Matt Corallo
- <a href="https://github.com/bitcoin/bips/blob/master/bip-0321.mediawiki" target="_blank"><cite>URI Scheme</cite></a>.
- 2024.
</summary>
<section class="abstract">
<h2 id="summaryabstract-2"><a class="header" href="#summaryabstract-2">Summary/Abstract</a></h2>
<div>This document proposes a URI scheme for describing Bitcoin payment instructions.</div>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="BIP327" class="ref">
<summary class="citation">
<a id="BIP327">[BIP327]</a>
- Jonas Nick, Tim Ruffing, Elliott Jin
- <a href="https://github.com/bitcoin/bips/blob/master/bip-0327.mediawiki" target="_blank"><cite>MuSig2 for BIP340-compatible Multi-Signatures</cite></a>.
- 2022.
</summary>
<section class="abstract">
<h2 id="summaryabstract-3"><a class="header" href="#summaryabstract-3">Summary/Abstract</a></h2>
<div>This document proposes a standard for the MuSig2 multi-signature scheme. The standard is compatible with BIP340 public keys and signatures. It supports tweaking, which allows deriving BIP32 child keys from aggregate public keys and creating BIP341 Taproot outputs with key and script paths.</div>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="BIP340" class="ref">
<summary class="citation">
<a id="BIP340">[BIP340]</a>
- Pieter Wuille, Jonas Nick, Tim Ruffing
- <a href="https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki" target="_blank"><cite>Schnorr Signatures for secp256k1</cite></a>.
- 2020.
</summary>
<section class="abstract">
<h2 id="summaryabstract-4"><a class="header" href="#summaryabstract-4">Summary/Abstract</a></h2>
<div>This document proposes a standard for 64-byte Schnorr signatures over the elliptic curve secp256k1.</div>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="BIP340-Cryptosuite" class="ref">
<summary class="citation">
<a id="BIP340-Cryptosuite">[BIP340-Cryptosuite]</a>
- Will Abramson
- <a href="https://dcdpr.github.io/data-integrity-schnorr-secp256k1/" target="_blank"><cite>Data Integrity BIP340 Cryptosuites</cite></a>.
- 2025.
</summary>
<section class="abstract">
<h2 id="summaryabstract-5"><a class="header" href="#summaryabstract-5">Summary/Abstract</a></h2>
<div>This specification describes Data Integrity cryptographic suites for use when creating or verifying a digital signature using the the secp256k1 instantiation of the Schnorr Signature Algorithm as defined in BIP340.</div>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="BIP350" class="ref">
<summary class="citation">
<a id="BIP350">[BIP350]</a>
- Pieter Wuille
- <a href="https://github.com/bitcoin/bips/blob/master/bip-0350.mediawiki" target="_blank"><cite>Bech32m format for v1+ witness addresses</cite></a>.
- 2020.
</summary>
<section class="abstract">
<h2 id="summaryabstract-6"><a class="header" href="#summaryabstract-6">Summary/Abstract</a></h2>
<div>This document defines an improved variant of Bech32 called Bech32m, and amends BIP173 to use Bech32m for native segregated witness outputs of version 1 and later. Bech32 remains in use for segregated witness outputs of version 0.</div>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="CID" class="ref">
<summary class="citation">
<a id="CID">[CID]</a>
- Dave Longley, Manu Sporny, Markus Sabadello, Drummond Reed, Orie Steele, Christopher Allen
- <a href="https://www.w3.org/TR/cid-1.0/" target="_blank"><cite>Controlled Identifiers v1.0</cite></a>.
- 2025.
</summary>
<section class="abstract">
<h2 id="summaryabstract-7"><a class="header" href="#summaryabstract-7">Summary/Abstract</a></h2>
<div>A controlled identifier document contains cryptographic material and lists service endpoints for the purposes of verifying cryptographic proofs from, and interacting with, the controller of an identifier.</div>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="DID-CORE" class="ref">
<summary class="citation">
<a id="DID-CORE">[DID-CORE]</a>
- Manu Sporny, Dave Longley, Markus Sabadello, Drummond Reed, Orie Steele, Christopher Allen
- <a href="https://www.w3.org/TR/did-1.1/" target="_blank"><cite>Decentralized Identifiers (DIDs) v1.1</cite></a>.
- 2025.
</summary>
<section class="abstract">
<h2 id="summaryabstract-8"><a class="header" href="#summaryabstract-8">Summary/Abstract</a></h2>
<div>Decentralized identifiers (DIDs) are a new type of identifier that enables verifiable, decentralized digital identity. A DID refers to any subject (e.g., a person, organization, thing, data model, abstract entity, etc.) as determined by the controller of the DID. In contrast to typical, federated identifiers, DIDs have been designed so that they may be decoupled from centralized registries, identity providers, and certificate authorities. Specifically, while other parties might be used to help enable the discovery of information related to a DID, the design enables the controller of a DID to prove control over it without requiring permission from any other party. DIDs are URIs that associate a DID subject with a DID document allowing trustable interactions associated with that subject.
<p>Each DID document can express cryptographic material, verification methods, or services, which provide a set of mechanisms enabling a DID controller to prove control of the DID. Services enable trusted interactions associated with the DID subject. A DID might provide the means to return the DID subject itself, if the DID subject is an information resource such as a data model.</p>
<p>This document specifies the DID syntax, a common data model, core properties, serialized representations, DID operations, and an explanation of the process of resolving DIDs to the resources that they represent.</div></p>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="DID-RESOLUTION" class="ref">
<summary class="citation">
<a id="DID-RESOLUTION">[DID-RESOLUTION]</a>
- Markus Sabadello, Dmitri Zagidulin
- <a href="https://www.w3.org/TR/did-resolution" target="_blank"><cite>Decentralized Identifier Resolution (DID Resolution) v0.3</cite></a>.
- 2025.
</summary>
<section class="abstract">
<h2 id="summaryabstract-9"><a class="header" href="#summaryabstract-9">Summary/Abstract</a></h2>
<div>Decentralized identifiers (DIDs) are a new type of identifier for verifiable, self-sovereign digital identity. DIDs are fully under the control of the DID controller, independent from any centralized registry, identity provider, or certificate authority. DIDs resolve to DID Documents — simple documents that describe how to use that specific DID.
<p>This document specifies the algorithms and guidelines for resolving DIDs and dereferencing DID URLs. Additionally, this document describes the input and output metadata related to the DID resolution processes and further describes the data structures that may be returned from a DID resolution request. This document relies on the core DID specification, Decentralized Identifiers (DIDs) v1.1, which describes the underlying DID architecture in full detail.</div></p>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="JSON-LD" class="ref">
<summary class="citation">
<a id="JSON-LD">[JSON-LD]</a>
- Manu Sporny, Dave Longley, Gregg Kellogg, Markus Lanthaler, Pierre-Antoine Champin, Niklas Lindström
- <a href="https://www.w3.org/TR/json-ld11/" target="_blank"><cite>JSON-LD 1.1</cite></a>.
- 2020.
</summary>
<section class="abstract">
<h2 id="summaryabstract-10"><a class="header" href="#summaryabstract-10">Summary/Abstract</a></h2>
<div>JSON is a useful data serialization and messaging format. This specification defines JSON-LD 1.1, a JSON-based format to serialize Linked Data. The syntax is designed to easily integrate into deployed systems that already use JSON, and provides a smooth upgrade path from JSON to JSON-LD. It is primarily intended to be a way to use Linked Data in Web-based programming environments, to build interoperable Web services, and to store Linked Data in JSON-based storage engines.
<p>This specification describes a superset of the features defined in JSON-LD 1.0 and, except where noted, documents created using the 1.0 version of this specification remain compatible with JSON-LD 1.1.</div></p>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="RFC4648" class="ref">
<summary class="citation">
<a id="RFC4648">[RFC4648]</a>
- Josefsson, S.
- <a href="https://datatracker.ietf.org/doc/html/rfc4648" target="_blank"><cite>The Base16, Base32, and Base64 Data Encodings</cite></a>.
- 2006.
</summary>
<section class="abstract">
<h2 id="summaryabstract-11"><a class="header" href="#summaryabstract-11">Summary/Abstract</a></h2>
<div>This document describes the commonly used base 64, base 32, and base 16 encoding schemes.  It also discusses the use of line-feeds in encoded data, use of padding in encoded data, use of non-alphabet characters in encoded data, use of different encoding alphabets, and canonical encodings.</div>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="RFC6902" class="ref">
<summary class="citation">
<a id="RFC6902">[RFC6902]</a>
- Bryan, P. and Nottingham, M.
- <a href="https://datatracker.ietf.org/doc/html/rfc6902" target="_blank"><cite>JavaScript Object Notation (JSON) Patch</cite></a>.
- 2013.
</summary>
<section class="abstract">
<h2 id="summaryabstract-12"><a class="header" href="#summaryabstract-12">Summary/Abstract</a></h2>
<div>JSON Patch defines a JSON document structure for expressing a sequence of operations to apply to a JavaScript Object Notation (JSON) document; it is suitable for use with the HTTP PATCH method. The application/json-patch+json media type is used to identify such patch documents.</div>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="RFC8785" class="ref">
<summary class="citation">
<a id="RFC8785">[RFC8785]</a>
- Rundgren, A. and Jordan, B. and Erdtman, S.
- <a href="https://datatracker.ietf.org/doc/html/rfc8785" target="_blank"><cite>JSON Canonicalization Scheme (JCS)</cite></a>.
- 2020.
</summary>
<section class="abstract">
<h2 id="summaryabstract-13"><a class="header" href="#summaryabstract-13">Summary/Abstract</a></h2>
<div>Cryptographic operations like hashing and signing need the data to be expressed in an invariant format so that the operations are reliably repeatable. One way to address this is to create a canonical representation of the data. Canonicalization also permits data to be exchanged in its original form on the wire while cryptographic operations performed on the canonicalized counterpart of the data in the producer and consumer endpoints generate consistent results.
<p>This document describes the JSON Canonicalization Scheme (JCS). This specification defines how to create a canonical representation of JSON data by building on the strict serialization methods for JSON primitives defined by ECMAScript, constraining JSON data to the Internet JSON (I-JSON) subset, and by using deterministic property sorting.</div></p>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="SEC" class="ref">
<summary class="citation">
<a id="SEC">[SEC]</a>
- Certicom Research and Daniel R. L. Brown
- <a href="https://www.secg.org/sec1-v2.pdf" target="_blank"><cite>Standards for Efficient Cryptography 1 (SEC 1): Elliptic Curve Cryptography</cite></a>.
- 2009.
</summary>
<section class="abstract">
<h2 id="summaryabstract-14"><a class="header" href="#summaryabstract-14">Summary/Abstract</a></h2>
<div>This document specifies public-key cryptographic schemes based on elliptic curve cryptography (ECC). In particular, it specifies:
<ul>
<li>signature schemes;</li>
<li>encryption and key transport schemes; and</li>
<li>key agreement schemes.</li>
</ul>
<p>It also describes cryptographic primitives which are used to construct the schemes, and ASN.1 syntax for identifying the schemes.</p>
<p>The schemes are intended for general application within computer and communications systems.</div></p>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="SHA256" class="ref">
<summary class="citation">
<a id="SHA256">[SHA256]</a>
- {National Institute of Standards and Technology}
- <a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf" target="_blank"><cite>Secure Hash Standard (SHS)</cite></a>.
- 2015.
</summary>
<section class="abstract">
<h2 id="summaryabstract-15"><a class="header" href="#summaryabstract-15">Summary/Abstract</a></h2>
<div>This standard specifies hash algorithms that can be used to generate digests of messages. The digests are used to detect whether messages have been changed since the digests were generated.</div>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="VC-DATA-INTEGRITY" class="ref">
<summary class="citation">
<a id="VC-DATA-INTEGRITY">[VC-DATA-INTEGRITY]</a>
- Dave Longley, Manu Sporny, Ivan Herman
- <a href="https://www.w3.org/TR/vc-data-integrity/" target="_blank"><cite>Verifiable Credential Data Integrity 1.0</cite></a>.
- 2025.
</summary>
<section class="abstract">
<h2 id="summaryabstract-16"><a class="header" href="#summaryabstract-16">Summary/Abstract</a></h2>
<div>This specification describes mechanisms for ensuring the authenticity and integrity of verifiable credentials and similar types of constrained digital documents using cryptography, especially through the use of digital signatures and related mathematical proofs.</div>
<hr>
</section>
</details>
</div>
<br/>
<div class="bib_div">
<details data-key="ZCAP-LD" class="ref">
<summary class="citation">
<a id="ZCAP-LD">[ZCAP-LD]</a>
- Christine Lemmer-Webber, Manu Sporny, Mark S. Miller
- <a href="https://w3c-ccg.github.io/zcap-spec/" target="_blank"><cite>Authorization Capabilities for Linked Data v0.3</cite></a>.
- 2025.
</summary>
<section class="abstract">
<h2 id="summaryabstract-17"><a class="header" href="#summaryabstract-17">Summary/Abstract</a></h2>
<div>Authorization Capabilities for Linked Data (ZCAP-LD for short) provides a secure way for linked data systems to grant and express authority utilizing the object capability model. Capabilities are represented as linked data objects which are signed with Linked Data Proofs. ZCAP-LD supports delegating authority to other entities on the network by chaining together capability documents. Caveats may be attached to capability documents which may be used to restrict the scope of their use, for example to restrict the actions which may be used or providing a mechanism by which the capability may be later revoked.</div>
<hr>
</section>
</details>
</div>
<br/>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="src/assets/mermaid.min.js"></script>
        <script src="src/assets/mermaid-init.js"></script>
        <script src="src/assets/tabs.js"></script>
        <script src="theme/pagetoc.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
